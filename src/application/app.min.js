var app=angular.module("teacherApp",["ngRoute","myServices","myFilter","ngCookies"]),api_url="http://115.29.177.200:8080",withoutToken={POST:[api_url+"/login"],GET:[api_url+"/image/code"]};app.config(["$filterProvider","$routeProvider","$httpProvider","$sceDelegateProvider",function(e,t,i,s){t.when("/login",{templateUrl:"./views/login/login.html"}),t.when("/register",{templateUrl:"./views/register/register.html"}),t.when("/prompt",{templateUrl:"./views/validate/prompt.html"}),t.when("/validation",{templateUrl:"./views/validate/validation.html"}),t.when("/activate",{templateUrl:"./views/validate/activate.html"}),t.when("/sendmail",{templateUrl:"./views/forgot/sendMail.html"}),t.when("/tips",{templateUrl:"./views/forgot/tips.html"}),t.when("/repassword",{templateUrl:"./views/forgot/repassword.html"}),t.when("/validate",{templateUrl:"./views/forgot/validate.html"}),t.when("/index",{templateUrl:"./views/index/index.html"}),t.when("/class/list",{templateUrl:"./views/class/list.html"}),t.when("/class/public",{templateUrl:"./views/class/public.html"}),t.when("/class/live",{templateUrl:"./views/class/live.html"}),t.when("/class/create",{templateUrl:"./views/class/create.html"}),t.when("/class/createSuccess/:cid",{templateUrl:"./views/class/createSuccess.html"}),t.when("/class/members/:cid",{templateUrl:"./views/class/members.html"}),t.when("/class/blacklist/:cid",{templateUrl:"./views/class/blacklist.html"}),t.when("/class/represent/:cid",{templateUrl:"./views/class/represent.html"}),t.when("/class/record/:cid",{templateUrl:"./views/class/record.html"}),t.when("/class/result/:cid/:wid",{templateUrl:"./views/class/result.html"}),t.when("/class/modify/:cid",{templateUrl:"./views/class/modify.html"}),t.when("/class/permission/:cid",{templateUrl:"./views/class/permission.html"}),t.when("/class/questionbank/:cid",{templateUrl:"./views/class/questionbank.html"}),t.when("/class/personinfo/:cid/:uid",{templateUrl:"./views/class/personinfo.html"}),t.when("/paper/list/:type",{templateUrl:"./views/paper/list.html"}),t.when("/paper/public",{templateUrl:"./views/paper/public.html"}),t.when("/paper/publish/:pid/:gid",{templateUrl:"./views/paper/publish.html"}),t.when("/paper/name",{templateUrl:"./views/paper/name.html"}),t.when("/paper/tag",{templateUrl:"./views/paper/tag.html"}),t.when("/paper/name/:pid",{templateUrl:"./views/paper/name.html"}),t.when("/paper/input/:pid",{templateUrl:"./views/paper/input.html"}),t.when("/paper/edit/:pid",{templateUrl:"./views/paper/edit.html"}),t.when("/paper/editor/:pid",{templateUrl:"./views/paper/editor.html"}),t.when("/paper/preview/:pid",{templateUrl:"./views/paper/preview.html"}),t.when("/paper/wxpreview/:pid",{templateUrl:"./views/paper/wxPreview.html"}),t.when("/paper/goodspreview/:pid/:gid",{templateUrl:"./views/paper/goodsPreview.html"}),t.when("/paper/complete/:pid",{templateUrl:"./views/paper/complete.html"}),t.when("/paper/export/:pid",{templateUrl:"./views/paper/export.html"}),t.when("/work/list",{templateUrl:"./views/work/list.html"}),t.when("/work/arrange",{templateUrl:"./views/work/arrange.html"}),t.when("/work/arrange/:pid/:gid",{templateUrl:"./views/work/arrange.html"}),t.when("/work/detail/:wid",{templateUrl:"./views/work/detail.html"}),t.when("/work/correct/:workId",{templateUrl:"./views/work/correct.html"}),t.when("/setting",{templateUrl:"./views/setting/setting.html"}),t.when("/password",{templateUrl:"./views/setting/password.html"}),t.when("/account",{templateUrl:"./views/setting/account.html"}),t.otherwise({redirectTo:"/index"}),i.interceptors.push("myInterceptor"),s.resourceUrlWhitelist(["self","**"])}]),app.factory("myInterceptor",["$rootScope","$cookieStore",function(e,t){var i={request:function(e){if(t.get("user"))var i=t.get("user").token;angular.isObject(e.url)&&(e.url=e.url.url);var s=e.url.split("?");if(e.url.indexOf(api_url)!==-1&&i)if(withoutToken[e.method])for(var a=withoutToken[e.method],r=0;r<a.length;r++)a[r]!=s[0]&&e.url.indexOf("?token=")==-1&&(2==s.length?e.url=e.url+"&token="+i:e.url=e.url+"?token="+i);else 2==s.length?e.url=e.url+"&token="+i:1==s.length&&(e.url=e.url+"?token="+i);return e},requestError:function(e){return e},response:function(e){if(angular.isObject(e.data)){var t=e.data.status;0===t?(e.data=e.data.data,e.data.status=t):2===t?(e.data=e.data.data,e.data.status=t):alert(e.data.info)}return e}};return i}]),app.run(["$rootScope","$location","$window","$cookieStore",function(e,t,i,s){e.$on("$viewContentLoaded",function(){e.location=t.path()}),e.$on("$routeChangeStart",function(){var e=s.get("user");void 0!=e&&"object"==typeof e||t.path("/login")})}]),app.controller("login",["$scope","$http","$location","$rootScope","$cookies","mxxServices",function(e,t,i,s,a,r){a.remove("user"),e.pass=a.getObject("pass"),e.refresh=function(){t.get(api_url+"/image/code?w=100&h=40").success(function(t){e.image=t.image,e.key=t.codeKey})},e.refresh();var n=" https://open.weixin.qq.com/connect/qrconnect?appid=wxf305ea0876e9955e&redirect_uri=http%3A%2F%2Fwww.maixuexi.cn%2Fteacher%2F&response_type=code&scope=snsapi_login&state=WeChatScanCodeEntry#wechat_redirect";r.loginQrcode($("#wxQrcode"),n),e.pass&&(e.email=e.pass.email,e.password=e.pass.password);var o=/^[a-zA-Z]\w+$/,c=/^1[34578]\d{9}$/,u=/^[\w-]+(\.[\w-]+)*@[\w-]+(\.[\w-]+)+$/;e.submit=function(){if(!e.email||!e.password||!e.captcha)return void alert("请填写完整后登录!");e.md5Pwd=hex_md5(e.password),e.md5Pwd=e.md5Pwd.split(""),e.md5Pwd[5]=e.password.charAt(0),e.md5Pwd[10]=e.password.charAt(1),e.md5Pwd[15]=e.password.charAt(2);var i={clientType:1,userType:1,password:e.md5Pwd.join(""),code:e.captcha,codeKey:e.key};if(u.test(e.email))i.email=e.email;else if(c.test(e.email))i.phone=e.email;else{if(!o.test(e.email))return void alert("登录信息不存在!");i.account=e.email}t.post(api_url+"/login",i).success(e.callback)},e.callback=function(s){return 1==s.status?($("#email").focus(),void e.refresh()):2==s.status?(e.captcha="",$("#captcha").focus(),void e.refresh()):void(0==s.status&&(e.tempToken=s.token,e.uid=s.uid,s.school&&1==s.school.length?t.post(api_url+"/login/in",{sid:s.school[0].sid,userType:1,token:s.token,uid:s.uid}).success(function(t){if(!t.status)if(t.voucher)window.location.href="http://www.maixuexi.cn/completion.html?tid="+t.tid+"&voucher="+t.voucher;else{e.loginTime=(new Date).getTime(),a.put("loginTime",e.loginTime);var s={};if(s.sid=t.schoolId,s.uid=t.uid,s.tid=t.tid,s.token=t.token,s.email=t.email,s.phone=t.phone,s.account=t.account,s.schoolName=t.schoolName,s.photo=t.photo,a.putObject("user",s),e.isRemember){var r=new Date;r.setDate(r.getDate()+30),a.putObject("pass",{email:e.email,password:e.password},{expires:r})}else a.remove("pass");i.path("index")}}):s.school&&s.school.length>1&&(e.schoolList=s.school)))},e.selected=function(t){e.chooseSid=t},e.confirm=function(){return e.chooseSid?void t.post(api_url+"/login/in",{sid:e.chooseSid,userType:1,token:e.tempToken,uid:e.uid}).success(function(t){if(!t.status)if(t.voucher)window.location.href="http://www.maixuexi.cn/completion.html?tid="+t.tid+"&voucher="+t.voucher;else{e.loginTime=(new Date).getTime(),a.put("loginTime",e.loginTime);var s={};if(s.sid=t.schoolId,s.uid=t.uid,s.tid=t.tid,s.token=t.token,s.email=t.email,s.phone=t.phone,s.account=t.account,s.schoolName=t.schoolName,s.teacherName=t.teacherName,a.putObject("user",s),e.isRemember){var r=new Date;r.setDate(r.getDate()+30),a.putObject("pass",{email:e.email,password:e.password},{expires:r})}else a.remove("pass");i.path("index")}}):void alert("请选择学校!")}}]),app.controller("index",["$scope","$http","$location","$rootScope","$routeParams","$filter","$cookieStore",function(e,t,i,s,a,r,n){e.userInfo=n.get("user"),e.loginTime=n.get("loginTime"),0==e.userInfo.tid&&(s.activateUid=e.userInfo.uid,s.ishidden=1,i.path("register")),e.currentPage=i.search().currentPage,e.currentPage||(e.currentPage=1),1==e.currentPage&&$(".home").css("display","none"),t.get(api_url+"/teacher/report").success(function(t){t.status||(e.classesInfo=t["class"],e.worksInfo=t.work,e.papersInfo=t.testPaper)}),e.pageSize=10,e.pageLength=7,e.offset=(e.pageLength+1)/2,e.getData=function(){t.get(api_url+"/teacher/work/recently?page="+e.currentPage+"&size="+e.pageSize).success(function(t){if(!t.status){e.worklist=t.workList;for(var i=0;i<e.worklist.length;i++)if(e.worklist[i].avgScore){e.worklist[i].avgScore=e.worklist[i].avgScore.toString();var s=e.worklist[i].avgScore.indexOf(".");s!=-1&&(e.worklist[i].avgScore=e.worklist[i].avgScore.substring(0,s+3))}if(e.currentPage=Number(e.currentPage),e.count=t.count,e.num=Math.ceil(e.count/e.pageSize),e.currentPage==e.num&&$(".final").css("display","none"),e.pageNums=[],e.num>1)if(e.currentPage>=e.offset)if(e.currentPage+e.offset<e.num)for(var i=e.currentPage-e.offset+1;i<e.currentPage+e.offset;i++)e.pageNums.push(i);else if(e.num>=e.pageLength)for(var i=e.num-e.pageLength;i<e.num;i++)e.pageNums.push(i);else for(var i=0;i<e.num;i++)e.pageNums.push(i);else if(e.num<e.pageLength)for(var i=0;i<e.num;i++)e.pageNums.push(i);else for(var i=0;i<e.pageLength;i++)e.pageNums.push(i);else $(".final").css("display","none"),$(".home").css("display","none")}})},e.getData(),e.skip=function(e){if(e.target.className.indexOf("current")!=-1)return!1}}]),app.controller("classlist",["$rootScope","$scope","$location","$http","$cookieStore","$timeout","mxxServices",function(e,t,i,s,a,r,n){t.tid=a.get("user").tid,t.currentPage=1,t.pageSize=9,t.classTypeName=["","公共班级","我的班级"],t.getData=function(){s.get(api_url+"/teacher/class/list?tid="+t.tid+"&page="+t.currentPage+"&size="+t.pageSize).success(function(e){if(!e.status){t.count=e.count,t.priviteClasses=e.classList;for(var i=0;i<t.priviteClasses.length;i++)t.priviteClasses[i].className.length>16?t.priviteClasses[i].shortClassName=t.priviteClasses[i].className.substring(0,16)+"...":t.priviteClasses[i].shortClassName=t.priviteClasses[i].className;0==t.count?t.num=1:t.num=Math.ceil(t.count/t.pageSize)}})},t.linkToClass=function(e){i.path("class/members/"+e)},t.search=function(){t.className&&(t.currentPage=1,s.put(api_url+"/teacher/class/search?page="+t.currentPage+"&size="+t.pageSize,{className:t.className,type:2,tid:t.tid}).success(function(e){t.className="",t.count=e.count,0==t.count?alert("班级不存在"):(t.priviteClasses=e.classList,t.num=Math.ceil(t.count/t.pageSize))}))},document.onkeydown=function(e){var e=e||window.ev;e.keyCode&&13==e.which&&t.search()},t.mouse={mouseover:function(){$(".handle-menu").css("display","block")},mouseout:function(){$(".handle-menu").css("display","none")}},t.isAllVisible=!1,t.visible={},t.allCheck=function(){t.isAllVisible?(t.isAllVisible=!1,t.visible={}):(t.isAllVisible=!0,angular.forEach(t.classlist,function(e,i,s){t.visible[e.cid]=!0}))},t.oneCheck=function(e){if(t.visible[e])delete t.visible[e],t.isAllVisible=!1;else{t.visible[e]=!0;var i=0;for(key in t.visible)i++;i==t.classlist.length&&(t.isAllVisible=!0)}},t["delete"]=function(){var e=[];for(key in t.visible)e.push(key);if(0==e.length)return void alert("请选择要删除的班级!");var i={method:"DELETE",url:api_url+"/class",data:{cid:e},headers:{"Content-Type":"application/json;charset=utf-8"}};s(i).success(function(e){e.status||(t.getData(),alert("删除班级成功!"))})},t.change=function(){var e=[];for(key in t.visible)e.push(key);return 1!=e.length?void alert("请选择一个班级!"):void i.path("class/modify/"+e[0])}}]),app.controller("publicClass",["$scope","$http","mxxServices","$cookieStore","$location",function(e,t,i,s,a){e.tid=s.get("user").tid,e.currentPage=1,e.pageSize=6,e.getData=function(){t.get(api_url+"/teacher/class/pending?tid="+e.tid+"&page="+e.currentPage+"&size="+e.pageSize).success(function(t){t.status||(e.count=t.count,e.publicClasses=t.classList,0==e.count?(e.num=1,$(".body").html('<p class="tips">您还没有任何公共班级邀请哦~~~</p>')):e.num=Math.ceil(e.count/e.pageSize))})},e.isAgree=function(i,s){"agree"==s.target.className?e.isagree=1:e.isagree=2,t.put(api_url+"/class/teacher/reply",{tid:parseInt(e.tid),cid:parseInt(i),isAgree:e.isagree}).success(function(t){1==e.isagree&&a.path("class/permission/"+i),2==e.isagree&&$(s.target).parents(".box").remove()})},e.linkToClass=function(e,t){1===t&&a.path("class/permission/"+e)},e.changeCourse=function(e,t){1===e&&(t.target.style.cursor="pointer")},e.search=function(i){e.className&&i.keyCode&&13==i.which&&(e.currentPage=1,t.put(api_url+"/teacher/class/search?page="+e.currentPage+"&size="+e.pageSize,{className:e.className,type:1,tid:e.tid}).success(function(t){e.className="",e.count=t.count,0==e.count?alert("班级不存在"):(e.priviteClasses=t.classList,e.num=Math.ceil(e.count/e.pageSize))}))}}]),app.controller("classlive",["$scope","$http","mxxServices","$cookieStore","$location",function(e,t,i,s,a){e.tid=s.get("user").tid,e.token=s.get("user").token,e.teacherName=s.get("user").teacherName,e.currentPage=1,e.pageSize=10,e.liveStatusName=["未开始","进行中","已结束"],e.nowTime=Date.parse(new Date)/1e3,e.startTime="2017-01-01 00:00:00",e.endTime="2100-10-25 23:00:00",e.getData=function(){t.get(api_url+"/teacher/class/live/time/list?startTime="+e.startTime+"&endTime="+e.endTime+"&page="+e.currentPage+"&size="+e.pageSize).success(function(t){if(!t.status){e.count=t.count,e.liveTimeList=t.liveRoomList;for(var i=0;i<e.liveTimeList.length;i++)e.startTimeOne=Date.parse(e.liveTimeList[i].startTime)/1e3,e.endTimeOne=Date.parse(e.liveTimeList[i].endTime)/1e3,(e.nowTime>e.startTimeOne||e.nowTime==e.startTimeOne)&&(e.nowTime<e.endTimeOne||e.nowTime==e.endTimeOne)?e.liveTimeList[i].liveStatus=1:e.nowTime<e.startTimeOne?e.liveTimeList[i].liveStatus=0:e.nowTime>e.endTimeOne&&(e.liveTimeList[i].liveStatus=2);0==e.count?(e.num=1,$(".body").html('<p class="tips">您还没有直播哦~~~</p>')):e.num=Math.ceil(e.count/e.pageSize)}})},e.search=function(){return e.startTime=$("#startTime").val(),e.endTime=$("#endTime").val(),e.startTime&&e.endTime?(e.currentPage=1,void e.getData()):void alert("请选择搜索条件")},e.configResource=function(e){alert("资源配置很快就会上线哦")},e.goToLive=function(t,i){if(e.teacherName||(e.teacherName="Mike"),1==i){var s=encodeURI("http://live.buka.tv/v4/"+t+"?room_id="+t+"&role=1&nickname="+e.teacherName+"&login_id="+e.tid+"&token="+e.token+"&client=1");window.open(s)}else alert("当前不在直播时间哦！")}}]),app.controller("createClass",["$scope","$http","$location","$cookieStore","toolServices",function(e,t,i,s,a){e.tid=s.get("user").tid,e.sid=s.get("user").sid,$(".create-password").click(function(){e.password=a.getRandomNum(1e5,99999999)+"",$(".form-control.password").val(e.password)}),e.validateOne=function(){return e.classNumber>200?void alert("班级人数不能超过200人!"):e.classNumber<1?void alert("班级人数不能少于1人!"):isNaN(e.classNumber-1)?void alert("请填写合法的班级人数!"):void 0},e.validateTwo=function(){if(e.password){var t=/^\d{6,8}$/;if(!t.test(e.password))return void alert("密码必须是6-8位的数字!")}},e.submit=function(){if(e.classNumber>200)return void alert("班级人数不能超过200人!");if(e.classNumber<1)return void alert("班级人数不能少于1人!");if(isNaN(e.classNumber-1))return void alert("请填写合法的班级人数!");if(e.password){var s=/^\d{6,8}$/;if(!s.test(e.password))return void alert("密码必须是6-8位的数字!")}if(e.classAnnounce&&e.classAnnounce.length>140)return void alert("班级留言不得超过140字!");var a={createTid:parseInt(e.tid),className:e.className,maxNumber:parseInt(e.classNumber),password:e.password,remarkName:e.classAnnounce};a=JSON.stringify(a),t.post(api_url+"/class",a).success(function(t){t.status||(alert("创建班级成功"),e.cid=t.cid,i.path("/class/createSuccess/"+e.cid))})}}]),app.controller("members",["$scope","$rootScope","$http","$routeParams","$cookieStore","$location","mxxServices",function(e,t,i,s,a,r,n){e.cid=s.cid,e.currentPage=1,e.pageSize=10,e.sid=a.get("user").sid,e.tid=a.get("user").tid,n.getClassInfo(e),e.getData=function(){i.get(api_url+"/class/student/list?cid="+e.cid+"&page="+e.currentPage+"&size="+e.pageSize).success(function(t){t.status||(e.count=t.count,e.userlist=t.studentList,0==e.count?(e.num=1,$(".student-list-body").html('<p clasas="tips" style="padding-top:40px;text-align:center;font-size:20px; color:#666;background-color:#ececec;">该班暂时没有学生加入!</p>')):e.num=Math.ceil(e.count/e.pageSize))})},n.showClass2WM(e),e.search=function(){e.currentPage=1,i.put(api_url+"/class/student/search?page="+e.currentPage+"&size="+e.pageSize,{studentName:e.username,cid:parseInt(e.cid)}).success(function(t){t.status||(e.count=t.count,0==e.count?alert("该班级下无此学生"):(e.userlist=t.studentList,e.num=Math.ceil(e.count/e.pageSize)))})},e.alert=function(t){$(".dialog_wrp").css("display","block"),$(".mask").css("display","block"),e.confirm=function(){return e.nickname?e.nickname.trim().length>12?void alert("备注名超过了12字限制"):void i.put(api_url+"/class/student",{cid:parseInt(e.cid),studentId:t,remarkName:e.nickname}).success(function(t){e.nickname="",$(".dialog_wrp").css("display","none"),$(".mask").css("display","none"),e.getData()}):void alert("请填写备注!")}},e.cancel=function(){$(".dialog_wrp").css("display","none"),$(".mask").css("display","none")},e["delete"]=function(t){i.put(api_url+"/class/student/blackList",{cid:parseInt(e.cid),studentId:t,dataStatus:-1}).success(function(t){alert("踢出班级成功!"),e.getData()})},e.remove=function(t){i.put(api_url+"/class/student/blackList",{cid:parseInt(e.cid),studentId:t,dataStatus:2}).success(function(t){alert("操作成功!"),e.getData()})}}]),app.controller("blacklist",["$scope","$http","$location","$routeParams","$cookieStore","mxxServices",function(e,t,i,s,a,r){e.cid=s.cid,e.sid=a.get("user").sid,e.tid=a.get("user").tid,e.currentPage=1,e.pageSize=10,r.getClassInfo(e),e.getData=function(){t.get(api_url+"/class/student/blackList?cid="+e.cid+"&page="+e.currentPage+"&size="+e.pageSize).success(function(t){e.count=t.count,e.userlist=t.studentList,0==e.count?e.num=1:e.num=Math.ceil(e.count/e.pageSize)})},e.getData(),r.showClass2WM(e),e.remove=function(i){t.put(api_url+"/class/student/blackList",{cid:parseInt(e.cid),studentId:i,dataStatus:-1}).success(function(t){alert("操作成功!"),e.getData()})},e.alert=function(i){$(".dialog_wrp").css("display","block"),e.confirm=function(){return e.nickname?void t.put(api_url+"/class/student",{cid:parseInt(e.cid),studentId:i,remarkName:e.nickname}).success(function(t){e.nickname="",alert("修改备注成功!"),$(".dialog_wrp").css("display","none"),e.getData()}):void alert("请填写备注!")}},e.cancel=function(){$(".dialog_wrp").css("display","none")}}]),app.controller("createSuccess",["$scope","$http","$routeParams","$cookieStore","mxxServices",function(e,t,i,s,a){e.cid=i.cid,e.tid=s.get("user").tid,e.sid=s.get("user").sid,t.get(api_url+"/class/info?cid="+e.cid).success(function(t){e.className=t.className,e.description=t.remarkName,e.password=t.password,e.classNumber=t.maxNumber,a.showClass2WM(e);var i=$("#imgCode");a.qrCode(i,e.url)})}]),app.controller("represent",["$scope","$http","$routeParams","$cookieStore","$timeout","mxxServices",function(e,t,i,s,a,r){e.cid=i.cid,e.tid=s.get("user").tid,r.showClass2WM(e),r.getClassInfo(e),e.getList=function(){t.get(api_url+"/class/teacher/tutor?cid="+e.cid+"&tid="+e.tid).success(function(t){t.status||(e.monitorlist=t.tutorList,t.count&&a(function(){for(var t=0;t<e.monitorlist.length;t++){var i="http://www.maixuexi.cn/student/#/my/tutor/"+e.monitorlist[t].tutorId;imgCode=$($(".imgcode")[t]),imgCode.children()&&imgCode.empty(),r.qrCode(imgCode,i)}},500))})},e.getList(),e.monitorCode=function(){var i=$(".imgcode"),s=i.length;return s>=6?void alert("一个班级最多只能绑定六个助教!"):void t.post(api_url+"/class/tutor",{cid:parseInt(e.cid)}).success(function(t){e.getList()})},e.unbindRepresent=function(i,s){t.put(api_url+"/class/tutor/remove",{tutorId:[i]}).success(function(t){t.status||(alert("解除班级助教身份成功!"),e.getList())})},e.deleteQrCode=function(i,s){t({method:"delete",url:api_url+"/class/tutor",data:{tutorId:[i]},headers:{"Content-Type":"application/json;charset=utf-8"}}).success(function(t){t.status||(alert("删除二维码成功!"),e.getList())})}}]),app.controller("record",["$scope","$http","$routeParams","mxxServices","$cookieStore",function(e,t,i,s,a){e.cid=i.cid,e.sid=a.get("user").sid,e.tid=a.get("user").tid,e.currentPage=1,e.pageSize=10,s.getClassInfo(e),e.getData=function(){e.serachSuccess?e.searchData():t.get(api_url+"/work/class/list?cid="+e.cid+"&page="+e.currentPage+"&size="+e.pageSize).success(function(t){t.status||(e.count=t.count,e.num=Math.ceil(e.count/e.pageSize),0==e.num&&(e.num=1,$(".student-list-body").html('<p clasas="tips" style="padding-top:40px;text-align:center;font-size:18px; color:#666;background-color:#ececec;">当前班级下还没有作业记录，<a href="#/work/arrange" style="color:#000;font-size:20px;">赶快来布置一场吧！</a></p>')),e.worklist=t.workList)})},e.searchWork=function(){e.searchName&&(e.currentPage=1,e.searchData())},e.searchData=function(){t.put(api_url+"/work/teacher/name?page="+e.currentPage+"&size="+e.pageSize,{cid:e.cid,workName:e.searchName}).success(function(t){t.status||(e.serachSuccess=!0,e.count=t.count,e.num=Math.ceil(e.count/e.pageSize),0==e.num&&(e.num=1,$(".student-list-body").html('<p clasas="tips" style="padding-top:40px;text-align:center;font-size:18px; color:#666;background-color:#ececec;">当前班级下还没有搜索的作业记录</p>')),e.worklist=t.workList)})},s.showClass2WM(e)}]),app.controller("result",["$scope","$http","$routeParams","mxxServices","$cookieStore",function(e,t,i,s,a){e.cid=i.cid,e.wid=i.wid,e.sid=a.get("user").sid,e.tid=a.get("user").tid,e.currentPage=1,e.pageSize=1e3,s.getClassInfo(e),s.showClass2WM(e),e.showSingleTable=!0,e.load=!1,e.showStat=!0,e.showQuestionBox=!1,e.assignmentNow=!1,e.showSingleCountTable=function(t){if(1===t){if(!e.showSingleTable)return;e.showSingleTable=!1,e.load=!0}else if(2===t){if(e.showSingleTable)return;e.showSingleTable=!0,e.load=!1}},t.get(api_url+"/work/statistics?workId="+e.wid).success(function(t){e.wname=t.workName,e.submitNum=t.submitNumber,e.ansSeenTime=t.showAnswerType,e.endTime=t.endTime,e.maxScore=t.maxScore,e.avgScore=t.avgScore}),e.typeList=[{type:1,name:"分数"},{type:2,name:"答题时间"}],e.type=1,e.selected=function(i){t.get(api_url+"/work/rank?workId="+e.wid+"&type="+e.type+"&page="+e.currentPage+"&size="+e.pageSize).success(function(t){t.status||(e.userlist=t.rankList)})},e.selected(e.type),e.questionTypeName=["","客观题","主观题"],e.questionAnswerName=["A","B","C","D","E","F","G","H","I","J","K","L","M","N"],e.changeShowStatus=function(){e.showStat=!e.showStat,e.showStat||t.get(api_url+"/work/question/answer?workId="+e.wid).success(function(t){t.status?alert(t.info):e.worklist=t.workList})},e.checkStatus=["待批改","已批改"],e.showQuestion=function(i,s,a){e.showQuestionBox=!0,e.questionType=s,e.questionNumber=a,e.wrongStudentList=[],t.get(api_url+"/work/question/student/situation?workId="+e.wid+"&qid="+i).success(function(t){if(t.status)alert(t.info);else{e.studentList=t.studentList,e.questionScore=t.qScore,1==e.questionType&&(e.questionAnswer=t.answer);for(var i=0;i<e.studentList.length;i++){var s=e.studentList[i].score,a=s/e.questionScore*100;e.studentList[i].percentage=a,e.studentList[i].percentage<80&&(e.wrongStudentList=e.wrongStudentList.concat(e.studentList[i]))}0==e.wrongStudentList.length&&(e.showNoneStudent=!0)}})},e.closeStudentBox=function(){e.showQuestionBox=!1,e.assignmentNow=!1},e.assignmentWork=function(){return e.showNoneStudent?void alert("暂时没有人做错哦"):(e.assignmentNow=!0,t.get(api_url+"/test/paper/teacher?page=1&size=99999").success(function(t){if(t.status)alert(t.info);else{e.paperlist=t.paperList;for(var i=0;i<e.paperlist.length;i++)e.paperlist[i].paperName.length>14&&(e.paperlist[i].shortPaperName=e.paperlist[i].paperName.substring(0,14)+"...")}}),e.students=[],t.get(api_url+"/class/student/list?cid="+e.cid+"&page=1&size=1000").success(function(t){if(t.status)alert(t.info);else{e.classStudent=t.studentList;for(var i=0;i<e.classStudent.length;i++)for(var s=e.classStudent[i],a=s.studentId,r=0;r<e.wrongStudentList.length;r++){var n=e.wrongStudentList[r],o=n.studentId;a==o?s.isMake=1:s.isMake=0,e.students.push({studentId:s.studentId,isMake:s.isMake})}}}),void(e.cids=[{cid:e.cid,students:e.students}]))},e.returnQuestion=function(){e.assignmentNow=!1,e.targetPid="",e.targetPaperName="",e.shortTargetPaperName="",e.cids=[]},e.choosePaper=function(i,s){e.targetPid!=i&&1==s&&(e.targetPid=i,e.targetPaperName="",e.shortTargetPaperName="",t.get(api_url+"/test/paper?pid="+e.targetPid).success(function(t){t.status?alert(t.info):(e.targetPaperName=t.paperName,e.targetPaperName.length>14&&(e.shortTargetPaperName=e.targetPaperName.substring(0,14)+"..."))}))},e.cancelPaper=function(){e.targetPid="",e.targetPaperName="",e.shortTargetPaperName=""},e.searchPaperFromName=function(){e.paperName=document.getElementById("newPaperName").value,e.paperName?t.put(api_url+"/test/paper/search?page=1&size=1000",{paperName:e.paperName}).success(function(t){if(t.status)alert(t.info);else{e.paperlist=t.paperList,e.paperCount=t.count;for(var i=0;i<e.paperlist.length;i++)e.paperlist[i].paperName.length>14&&(e.paperlist[i].shortPaperName=e.paperlist[i].paperName.substring(0,14)+"...")}}):alert("请输入试卷名字")},e.getAllPaper=function(){e.newPaperName="",t.get(api_url+"/test/paper/teacher?page=1&size=99999").success(function(t){if(t.status)alert(t.info);else{e.paperlist=t.paperList;for(var i=0;i<e.paperlist.length;i++)e.paperlist[i].paperName.length>14&&(e.paperlist[i].shortPaperName=e.paperlist[i].paperName.substring(0,14)+"...")}})},e.isWholeWork=0,e.changeWholeWork=function(){1==e.isWholeWork?e.isWholeWork=0:e.isWholeWork=1},e.isOutOfOrder=0,e.changeOutOfOrder=function(){1==e.isOutOfOrder?e.isOutOfOrder=0:e.isOutOfOrder=1},e.isViewResolution=1,e.changeViewResolution=function(){1==e.isViewResolution?e.isViewResolution=2:e.isViewResolution=1},e.isJoinReport=1,e.changeJoinReport=function(){1==e.isJoinReport?e.isJoinReport=0:e.isJoinReport=1},e.workType=1,e.doneWorkAssignment=function(){if(!e.targetPid)return void alert("请选择试卷");if(e.hours=0,e.minute=0,e.second=0,e.durationTime=parseInt(60*e.hours*60)+parseInt(60*e.minute)+parseInt(e.second),0!=e.durationTime&&e.durationTime<60)return void alert("作业时长不得小于1分钟!");var i=new Date,s=i.getFullYear(),a=i.getMonth()+1,r=i.getDate(),n=i.getHours(),o=i.getMinutes(),c=i.getSeconds();if(a<10&&(a="0"+a),r<10&&(r="0"+r),n<10&&(n="0"+n),o<10&&(o="0"+o),c<10&&(c="0"+c),e.currentTime=s+"-"+a+"-"+r+" "+n+":"+o+":"+c,$(".beginTime").val()?e.startTime=$(".beginTime").val():e.startTime=e.currentTime,$(".endTime").val()){if(Date.parse(new Date($(".endTime").val()))<Date.parse(new Date(e.startTime)))return void alert("请正确填写开始结束时间!");e.endTime=$(".endTime").val()}else e.endTime=null,e.showAnswerType=1;if($(".noticeTime").val()){if(Date.parse(new Date($(".noticeTime").val()))<Date.parse(new Date(e.currentTime)))return void alert("请正确填写作业通知时间!");if(Date.parse(new Date($(".noticeTime").val()))>Date.parse(new Date(e.startTime)))return void alert("请选择早于作业开始时间的通知时间!");e.displayTime=$(".noticeTime").val()}else e.displayTime=e.currentTime;var u=new Date($(".beginTime").val()).getTime();if($(".endTime").val()){var p=new Date($(".endTime").val()).getTime();if((p-u)/1e3<e.durationTime)return void alert("作业时长不合法!")}e.workName=document.getElementById("workName").value,e.workName||(e.workName=e.targetPaperName);var l={pid:parseInt(e.targetPid),workName:e.workName,displayTime:e.displayTime,startTime:e.startTime,endTime:e.endTime,showAnswerType:parseInt(e.isViewResolution),durationTime:parseInt(e.durationTime),isMixed:parseInt(e.isOutOfOrder),isWholeWork:parseInt(e.isWholeWork),isJoinStatistics:parseInt(e.isJoinReport),cids:e.cids,workType:e.workType};l=JSON.stringify(l),t.post(api_url+"/work",l).success(function(t){t.status?alert(t.info):(alert("作业布置成功!"),e.assignmentNow=!1,e.targetPid="",e.targetPaperName="",e.workName="",e.shortTargetPaperName="",e.cids=[],e.showQuestionBox=!1,e.assignmentNow=!1)})}}]),app.controller("permission",["$scope","$http","$routeParams","mxxServices","$cookieStore","$location",function(e,t,i,s,a,r){e.cid=Number(i.cid),e.tid=a.get("user").tid,s.getClassInfo(e),s.showClass2WM(e);var n=/^[a-zA-Z]\w+$/,o=/^1[34578]\d{9}$/,c=/^[\w-]+(\.[\w-]+)*@[\w-]+(\.[\w-]+)+$/;e.search=function(){if(e.account){var i={};if(c.test(e.account))i.email=e.account;else if(o.test(e.account))i.phone=e.account;else{if(!n.test(e.account))return void alert("请输入有效账号信息!");i.account=e.account}t.put(api_url+"/teacher/info",i).success(function(t){t.status?e.tname="":(e.email=t.email,e.itid=t.tid,e.tname=t.teacherName)})}},e.invite=function(){t.put(api_url+"/class/teacher/invite",{cid:parseInt(e.cid),tid:parseInt(e.itid)}).success(function(t){t.status||(alert("邀请通知已发送!"),e.tname="",e.account="",e.getTeacherListByCid())})},e.isChecked=function(){t.put(api_url+"/class/teacher/set",{cid:parseInt(e.cid),isShow:Number(e.check)}).success(function(e){})},e.getTeacherListByCid=function(){t.get(api_url+"/class/teacher/list?cid="+e.cid).success(function(t){e.classTeacher=t.teacherList,e.b=t.teacherList[0],e.classTeacher.length&&angular.forEach(e.classTeacher,function(t,i){t.tid==e.tid&&(1==t.isShow?e.check=!0:e.check=!1),1==t.isOwner&&(e.create=t,e.classTeacher.splice(i,1))}),e.classTeacher.sort(function(e,t){return t.isAgree-e.isAgree})})},e.getTeacherListByCid(),e.changeCourse=function(t){e.teacherInfo=this.$parent.teacher,1==e.teacherInfo.isAgree&&(t.target.style.cursor="pointer")},e.transfer=function(i,s){if(e.teacherInfo=this.$parent.teacher,1===e.teacherInfo.classTeacher.isagree){var a=window.confirm("确定要将创建者身份转给该教师吗?");a&&t.put(api_url+"/class/teacher/owner",{tid:s,cid:parseInt(e.cid)}).success(function(t){e.getTeacherListByCid()})}},e["delete"]=function(i,s){var a=window.confirm("确定删除该教师?");a&&t({method:"delete",url:api_url+"/class/teacher/delete",data:{cid:e.cid,tid:s},headers:{"Content-Type":"application/json;charset=utf-8"}}).success(function(e){$(i.target).parents("tr").remove()})},e.leave=function(i){i==e.tid&&t.put(api_url+"/class/teacher/reply",{cid:parseInt(e.cid),isAgree:2}).success(function(e){r.path("class/list")})}}]),app.controller("questionbank",["$scope","$http","$routeParams","mxxServices","$cookieStore","$location",function(e,t,i,s,a,r){e.cid=Number(i.cid),e.tid=a.get("user").tid,e.currentPage=1,e.pageSize=10,e.showAddPaper=!1,s.showClass2WM(e),t.get(api_url+"/class/info?cid="+e.cid).success(function(t){e.className=t.className,e.password=t.password,e.limit=t.maxNumber,e.classNum=t.userNumber,e.createSid=t.sid,e.isPumping=t.isPumping,e.isPumping?(e.check=!0,e.getClassQuestionBankConfig()):e.check=!1}),e.getData=function(){t.get(api_url+"/class/paper/list?cid="+e.cid+"&page="+e.currentPage+"&size="+e.pageSize).success(function(t){e.count=t.count,0==e.count?e.num=1:(e.num=Math.ceil(e.count/e.pageSize),e.paperList=t.paperList)})},e.prev=function(){e.currentPage>1&&(e.currentPage--,e.getData())},e.next=function(){e.currentPage<e.num&&(e.currentPage++,e.getData())},e.isChecked=function(){var i;i=e.isPumping?0:1,t.post(api_url+"/class/question/bank/config",{cid:e.cid,isPumping:i}).success(function(t){1===i?(e.check=!0,e.isPumping=1,e.getClassQuestionBankConfig()):(e.check=!1,e.isPumping=0)})},e.getClassQuestionBankConfig=function(){t.get(api_url+"/class/question/bank/config?cid="+e.cid).success(function(t){if(e.dataId=t.dataId,e.paperNamePrefix=t.paperNamePrefix,e.totalAmount=t.totalAmount,e.amountConf=t.amountConf,e.amountInfo=t.amountInfo,e.totalScore=t.totalScore,e.totalDuration=Number(t.totalDuration),e.totalDuration){if(e.totalDuration<60)e.durationTime=e.totalDuration+"分钟",e.timeHour=0,e.timeMinute=e.totalDuration;else{var i=parseInt(e.totalDuration/60),s=e.totalDuration%60;e.timeHour=i,0===s?(e.durationTime=i+"小时",e.timeMinute=0):(e.durationTime=i+"小时"+s+"分钟",e.timeMinute=s)}e.backupsTime={timeHour:e.timeHour,timeMinute:e.timeMinute}}else e.durationTime=0;e.backupsConfig={dataId:e.dataId,paperNamePrefix:e.paperNamePrefix,totalAmount:e.totalAmount,amountInfo:e.amountInfo,totalDuration:e.totalDuration,totalScore:e.totalScore},e.amountConf?(e.singleselect=e.amountConf[1][0],e.multiselect=e.amountConf[1][1],e.judge=e.amountConf[1][2],e.subjective=e.amountConf[1][3],e.numberTotal=e.singleselect+e.multiselect+e.judge+e.subjective):(e.backupsConfig.amountConf=[[1,2,3,4],[0,0,0,0]],e.amountConf=e.backupsConfig.amountConf,
e.numberTotal=0),e.amountInfo?e.allNumber=e.amountInfo[1][0]+e.amountInfo[1][1]+e.amountInfo[1][2]+e.amountInfo[1][3]:(e.backupsConfig.amountInfo=[[1,2,3,4],[0,0,0,0]],e.amountInfo=e.backupsConfig.amountInfo,e.allNumber=0),e.isShowEdit=!1})},e.updateQuestionbankConfig=function(){return e.allNumber?(e.isShowEdit=!0,void console.log(e.timeMinute)):void alert("请先添加班级试卷哦")},e.validatePrefix=function(){return e.paperNamePrefix?e.paperNamePrefix.length>10?(alert("前缀名字不能大于10个字符"),void(e.paperNamePrefix=e.backupsConfig.paperNamePrefix)):void 0:void alert("请输入试卷前缀")},e.validateSingle=function(){if(e.singleselect){e.singleselect=Number(e.singleselect);var t=isNaN(e.singleselect);if(t)return alert("单选题数量，请输入数字"),void(e.singleselect=e.backupsConfig.amountConf[1][0]);if(0==e.amountInfo[1][0])return void alert("当前总题量单选题数量不足，请添加试卷或者设定合适的题量");if(e.singleselect<0)return alert("题量不能为负数"),void(e.singleselect=e.backupsConfig.amountConf[1][0]);if(e.amountInfo[1][0]<e.singleselect)return alert("请添加合适的题量"),void(e.singleselect=e.backupsConfig.amountConf[1][0]);e.numberTotal=e.singleselect+e.multiselect+e.judge+e.subjective}},e.validateMultiselect=function(){if(e.multiselect){e.multiselect=Number(e.multiselect);var t=isNaN(e.multiselect);if(t)return alert("多选题数量，请输入数字"),void(e.multiselect=e.backupsConfig.amountConf[1][1]);if(0==e.amountInfo[1][1])return void alert("当前总题量中多选题数量不足，请添加试卷或者设定合适的题量");if(e.multiselect<0)return alert("题量不能为负数"),void(e.multiselect=e.backupsConfig.amountConf[1][1]);if(e.amountInfo[1][1]<e.multiselect)return alert("请添加合适的题量"),void(e.multiselect=e.backupsConfig.amountConf[1][1]);e.numberTotal=e.singleselect+e.multiselect+e.judge+e.subjective}},e.validateJudge=function(){if(e.judge){e.judge=Number(e.judge);var t=isNaN(e.judge);if(t)return alert("判断题数量，请输入数字"),void(e.judge=e.backupsConfig.amountConf[1][2]);if(0==e.amountInfo[1][2])return void alert("当前总题量中判断题数量不足，请添加试卷试题");if(e.judge<0)return alert("题量不能为负数"),void(e.judge=e.backupsConfig.amountConf[1][2]);if(e.amountInfo[1][2]<e.judge)return alert("请添加合适的题量"),void(e.judge=e.backupsConfig.amountConf[1][2]);e.numberTotal=e.singleselect+e.multiselect+e.judge+e.subjective}},e.validateSubjective=function(){if(e.subjective){e.subjective=Number(e.subjective);var t=isNaN(e.subjective);if(t)return alert("主观题数量，请输入数字"),void(e.subjective=e.backupsConfig.amountConf[1][3]);if(0==e.amountInfo[1][3])return void alert("当前总题量中主观题数量不足，请添加试卷或者设定合适的题量");if(e.subjective<0)return alert("题量不能为负数"),void(e.subjective=e.backupsConfig.amountConf[1][3]);if(e.amountInfo[1][3]<e.subjective)return alert("请添加合适的题量"),void(e.subjective=e.backupsConfig.amountConf[1][3]);e.numberTotal=e.singleselect+e.multiselect+e.judge+e.subjective}},e.validateHour=function(){if(e.timeHour){var t=isNaN(e.timeHour);if(t)return alert("请输入数字"),void(e.timeHour=e.backupsTime.timeHour);if(e.timeHour<0)return alert("小时不能为负数"),void(e.timeHour=e.backupsTime.timeHour)}},e.validateMinute=function(){if(e.timeMinute){var t=isNaN(e.timeMinute);if(t)return alert("请输入数字"),void(e.timeMinute=e.backupsTime.timeMinute);if(!(e.timeMinute<60))return alert("分钟必须小于60"),void(e.timeMinute=e.backupsTime.timeMinute);if(e.timeMinute<0)return alert("分钟不能为负数"),void(e.timeMinute=e.backupsTime.timeMinute)}},e.validateScore=function(){if(e.totalScore){var t=isNaN(e.totalScore);if(t)return alert("请输入数字"),void(e.totalScore=e.backupsConfig.totalScore);if(e.totalScore<0)return alert("总分不能为负数"),void(e.totalScore=e.backupsConfig.totalScore)}},e.preservationConfig=function(){if(!e.paperNamePrefix||!e.totalAmount)return void alert("请输入组卷前缀和每次组卷题量");if(e.numberTotal=e.singleselect+e.multiselect+e.judge+e.subjective,e.numberTotal<1)return void alert("请填写题型数量");e.amountConf=[[1,2,3,4],[e.singleselect,e.multiselect,e.judge,e.subjective]];var i={dataId:e.dataId,paperNamePrefix:e.paperNamePrefix,totalAmount:e.numberTotal,amountConf:e.amountConf};(e.timeHour||e.timeMinute)&&(e.timeHour&&!e.timeMinute?e.totalDuration=60*e.timeHour:!e.timeHour&&e.timeMinute?e.totalDuration=e.timeMinute:e.timeHour&&e.timeMinute&&(e.totalDuration=60*e.timeHour+e.timeMinute),i.totalDuration=e.totalDuration),e.totalScore&&(i.totalScore=e.totalScore),t.put(api_url+"/class/question/bank/config",i).success(function(t){e.isShowEdit=!1,e.getClassQuestionBankConfig()})},e.cancelConfig=function(){e.isShowEdit=!1,e.paperNamePrefix=e.backupsConfig.paperNamePrefix,e.totalAmount=e.backupsConfig.totalAmount,e.totalDuration=e.backupsConfig.totalDuration,e.totalScore=e.backupsConfig.totalScore},e.showBoxOfAddPaper=function(){e.showAddPaper=!0,e.getMyPaperList()},e.cancelPaperBox=function(){e.showAddPaper=!1},e.getMyPaperList=function(){t.get(api_url+"/test/paper/teacher?page=1&size=1000").success(function(t){e.myPaperCount=t.count,e.myPaperList=t.paperList,e.newPaperList=new Array;for(var i=0;i<e.myPaperList.length;i++)1===e.myPaperList[i].isFinish&&e.newPaperList.push(e.myPaperList[i]);for(var s=0;s<e.newPaperList.length;s++)e.newPaperList[s].paperName.length>15?e.newPaperList[s].paperNameShort=e.newPaperList[s].paperName.substr(0,15)+"...":e.newPaperList[s].paperNameShort=e.newPaperList[s].paperName}),e.localPaperList=[]};var n=[];e.addToTheLocal=function(t,i,s,a){var r={pid:s,paperName:i,paperNameShort:t};n.push(s),e.localPaperList.push(r),e.newPaperList[a].showStatus=!0},e.removeFromLocal=function(t){for(var i=e.localPaperList[t].pid,s=0;s<e.newPaperList.length;s++)if(i==e.newPaperList[s].pid)return e.newPaperList[s].showStatus=!1,e.localPaperList.splice(t,1),void n.splice(t,1)},e.sureAddPaper=function(){return e.localPaperList.length>0?(console.log(n),void t.post(api_url+"/class/paper",{cid:e.cid,pid:n}).success(function(t){e.showAddPaper=!1,n=[],e.getData(),e.getClassQuestionBankConfig()})):void alert("请选择待添加的试卷")},e.removeFromClassPaper=function(i){t({method:"DELETE",url:api_url+"/class/paper",data:{classPaperId:[i]},headers:{"Content-Type":"application/json;charset=utf-8"}}).success(function(t){t.status||(e.getData(),e.getClassQuestionBankConfig())})}}]),app.controller("modify",["$scope","$http","$routeParams","$location","$cookieStore","mxxServices",function(e,t,i,s,a,r){e.cid=i.cid,e.sid=a.get("user").sid,e.tid=a.get("user").tid,r.getClassInfo(e),r.showClass2WM(e),t.get(api_url+"/class/info?cid="+e.cid).success(function(t){e.className=t.className,e.limit=t.maxNumber,e.password=t.password,e.reName=t.className,e.reNumber=t.maxNumber,e.rePassword=t.password,e.classAnnounce=t.remarkName||"",e.createSid=t.createTid,e.tid!==e.createSid&&$(".class-modify").addClass("return")}),e.tips=140,e.counter=function(){0==e.classAnnounce.trim().length&&($(".tips").css("display","none"),$(".error").css("display","none")),0<e.classAnnounce.trim().length<=140&&($(".tips").css("display","block"),$(".error").css("display","none"),e.tips=140-e.classAnnounce.trim().length),e.classAnnounce.trim().length>140&&($(".tips").css("display","none"),$(".error").css("display","block"),e.tips=e.classAnnounce.trim().length-140)},e.modify=function(){if($(".class-modify").hasClass("return"))return void alert("非班级创建者身份不可以修改班级信息");if(!(e.classAnnounce&&e.classAnnounce.trim().length>140)){if(isNaN(e.reNumber-1))return void alert("请填写合法的班级人数!");if(e.reNumber>200)return void alert("班级人数不能超过200人!");if(e.reNumber<e.classNum)return void alert("班级最大人数不能小于当前班级人数");if(e.rePass){var i=/^\d{6,8}$/;if(!i.test(e.rePass))return void alert("密码必须是6-8位的数字!")}var a={cid:parseInt(e.cid),className:e.reName,maxNumber:parseInt(e.reNumber),password:e.rePassword,remarkName:e.classAnnounce};a=JSON.stringify(a),t.put(api_url+"/class",a).success(function(e){alert("修改班级信息成功!"),s.path("/class/list")})}}}]),app.controller("personInfo",["$scope","$http","$cookieStore","$routeParams","mxxServices",function(e,t,i,s,a){e.cid=s.cid,e.uid=s.uid,e.sid=i.get("user").sid,e.tid=i.get("user").tid,a.getClassInfo(e),a.showClass2WM(e),t.get(api_url+"/student/class/report?studentId="+e.uid+"&cid="+e.cid).success(function(t){t.status||(e.user=t)})}]),app.controller("paperlist",["$scope","$http","$cookieStore","$location","$window","$routeParams",function(e,t,i,s,a,r){e.type=Number(r.type),e.tid=i.get("user").tid,e.currentPage=1,e.pageSize=10,e.isAllVisible=!1,e.visible={},e.allCheck=function(){e.isAllVisible?(e.isAllVisible=!1,e.visible={}):(e.isAllVisible=!0,angular.forEach(e.paperlist,function(t,i,s){e.visible[t.pid]=!0}))},e.oneCheck=function(t,i){if(e.visible[t])delete e.visible[t],e.isAllVisible=!1;else{e.visible[t]=!0;var s=0;for(key in e.visible)s++;s==e.paperlist.length&&(e.isAllVisible=!0)}var a=[];for(key in e.visible)a.push(key);1!=a.length?($(".handle-menu").find("a").removeAttr("href"),$(".export-paper").hasClass("disabled")||$(".export-paper").addClass("disabled")):1==e.paperlist[i].isFinish?($(".handle-menu").find("a").attr("href","#/paper/export/"+a[0]),$(".export-paper").removeClass("disabled")):($(".handle-menu").find("a").removeAttr("href"),$(".export-paper").hasClass("disabled")||$(".export-paper").addClass("disabled"))},e.mouse={mouseover:function(){$(".handle-menu").css("display","block")},mouseout:function(){$(".handle-menu").css("display","none")}},e.checkType=function(t){e.type=t,e.currentPage=1,e.isAllVisible=!1,e.visible={},0==e.type?e.getData():1==e.type?e.getGoodsData():2==e.type&&e.getAssistData()},e.next=function(){e.currentPage<e.num&&(e.currentPage++,0!=e.type||e.paperName?1==e.type?e.getGoodsData():2==e.type?e.getAssistData():e.paperName&&e.searchData():e.getData())},e.prev=function(){e.currentPage>1&&(e.currentPage--,0!=e.type||e.paperName?1==e.type?e.getGoodsData():2==e.type?e.getAssistData():e.paperName&&e.searchData():e.getData())},e.getData=function(){t.get(api_url+"/test/paper/teacher?page="+e.currentPage+"&size="+e.pageSize).success(function(t){e.count=t.count,0==e.count?e.num=1:(e.num=Math.ceil(e.count/e.pageSize),e.paperlist=t.paperList)})},e.getGoodsData=function(){t.get(api_url+"/goods/paper/teacher/relation?page="+e.currentPage+"&size="+e.pageSize).success(function(t){e.count=t.count,0==e.count?e.num=1:(e.num=Math.ceil(e.count/e.pageSize),e.goodslist=t.goodsList)})},e.getAssistData=function(){t.get(api_url+"/assist/test/paper/input/teacher/list?page="+e.currentPage+"&size="+e.pageSize).success(function(t){e.count=t.count,0==e.count?e.num=1:(e.num=Math.ceil(e.count/e.pageSize),e.assistList=t.assistList)})},0==e.type?e.getData():1==e.type?e.getGoodsData():2==e.type&&e.getAssistData(),e.cancelAssist=function(i){t({method:"DELETE",url:api_url+"/assist/test/paper/input",data:{ids:[i]},headers:{"Content-Type":"application/json;charset=utf-8"}}).success(function(t){t.status||e.getAssistData()})},e["delete"]=function(){var i=[];for(key in e.visible)i.push(Number(key));if(0==i.length)return void alert("请选择要删除的试卷!");var s=window.confirm("确定要删除试卷吗?");s?t({method:"DELETE",url:api_url+"/test/paper",data:{pid:i},headers:{"Content-Type":"application/json;charset=utf-8"}}).success(function(t){t.status||(e.getData(),e.isAllVisible=!1,e.visible={})}):e.visible={}},e.confirmPaper=function(){var i=[];for(key in e.visible)i.push(Number(key));return 0==i.length?void alert("请选择要敲定的习题!"):void t.post(api_url+"/test/paper/confirm",{pid:i}).success(function(t){t.status||(e.getData(),e.visible={})})},e.publish=function(){var t=[],i=!0;for(key in e.visible)t.push(Number(key));return 0==t.length?void alert("请选择要发布的习题!"):(angular.forEach(e.paperlist,function(e){angular.forEach(t,function(t){t==e.pid&&1!=e.isFinish&&(alert("请选择已敲定的习题!"),i=!1)})}),void(i&&s.path("paper/publish/"+t.join(",")+"/0")))},e.edit=function(){var i=[];for(key in e.visible)i.push(Number(key));return 0==i.length?void alert("请选择要编辑的习题!"):void t.post(api_url+"/test/paper/edit",{pid:i}).success(function(t){t.ret||(e.getData(),e.visible={})})},e.searchData=function(){t.put(api_url+"/test/paper/search?page="+e.currentPage+"&size="+e.pageSize,{paperName:e.paperName}).success(function(t){e.count=t.count,0==e.count?(e.num=1,e.paperName="",e.getData(),alert("没有找到您要搜索的试卷!")):(e.num=Math.ceil(e.count/e.pageSize),e.paperlist=t.paperList)})},e.search=function(){return e.paperName?(e.currentPage=1,void e.searchData()):void e.getData()},document.onkeydown=function(t){var t=t||window.ev;t.keyCode&&13==t.which&&e.search()},e.load=function(){$(".dialog_wrp").css("display","block"),$(".mask").css("display","block"),e.copycode="",e.captcha="",e.refresh()},e.refresh=function(){t.get(api_url+"/image/code?w=100&h=40").success(function(t){e.image=t.image,e.key=t.codeKey})},e.cancel=function(){$(".dialog_wrp").css("display","none"),$(".mask").css("display","none")},e.confirm=function(){return e.copyStatus=!0,e.copyFalie="",e.copycode?e.captcha?void t.post(api_url+"/test/paper/copy",{codeKey:e.key,code:e.captcha,copyCode:e.copycode}).success(function(t){t.status?(e.copyStatus=!1,e.copyFalie="拷贝失败",e.refresh(),e.captcha=""):(e.copyStatus=!1,e.copyFalie="",alert("习题导入成功!"),$(".dialog_wrp").css("display","none"),$(".mask").css("display","none"),e.getData())}):void alert("请输入验证码!"):void alert("请输入授权码!")},e["export"]=function(t){if($(".export-paper").hasClass("disabled"))return void $(".handle-menu").find("a").removeAttr("href");var i=[];for(key in e.visible)i.push(key);return 1!==i.length?(alert("请选择要导出的某一套试卷!"),!1):($(".export-paper").addClass("disabled"),void(e.visible={}))}}]),app.controller("paperPublish",["$scope","$http","$cookieStore","$location","$routeParams",function(e,t,i,s,a){e.pid=a.pid.split(",").map(function(e){return+e}),e.gid=Number(a.gid),e.back=function(){0==e.gid?s.path("paper/list"):s.path("paper/public")},e.selectedClass=[],e.selectedCourse=[],0==e.gid?(t.put(api_url+"/paper/info/get",{pid:e.pid}).success(function(t){e.paperList=t.paperList,angular.forEach(e.paperList,function(e){e.paperPrice=""})}),t.get(api_url+"/tag/public/stage/grade").success(function(t){e.tags=t.stageList}),t.get(api_url+"/tag?isPublic=1&tagType=3&isUse=1&page=1&size=1000").success(function(t){e.courses=t.tagList})):t.get(api_url+"/goods/paper?goodsId="+e.gid).success(function(i){e.goodName=i.goodsName,e.totalPrice=i.price,e.paperList=i.paperList,e.endTime=i.validityEndTime,e.someTagIds=[],angular.forEach(i.tagList,function(t){e.someTagIds.push(t.tagId)}),t.get(api_url+"/tag/public/stage/grade").success(function(t){e.tags=t.stageList,angular.forEach(e.tags,function(t){e.someTagIds.indexOf(t.tagId)!=-1&&(e.stageId=t.tagId,e.tagList=t.gradeList,$("#stage").attr("disabled",!0))}),angular.forEach(e.tagList,function(t){e.someTagIds.indexOf(t.tagId)!=-1&&e.selectedClass.push(t.tagId)})}),t.get(api_url+"/tag?isPublic=1&tagType=3&isUse=1&page=1&size=1000").success(function(t){e.courses=t.tagList,angular.forEach(e.courses,function(t){e.someTagIds.indexOf(t.tagId)!=-1&&e.selectedCourse.push(t.tagId)})})}),e.getPrice=function(t,i){isNaN(Number(i.target.value))?(i.target.value="0.00",e.paperList[t].paperPrice="0.00"):e.paperList[t].paperPrice=Number(Number(i.target.value).toFixed(2)),e.totalPrice=0,e.paperList.map(function(t){e.totalPrice+=Number(t.paperPrice)})},e.deletePaper=function(t){e.paperList.splice(t,1),e.totalPrice=0,e.paperList.map(function(t){e.totalPrice+=Number(t.paperPrice)})},e.chooseStage=function(){angular.forEach(e.tags,function(t){t.tagId==e.stageId&&(e.tagList=t.gradeList)})},e.chooseClass=function(t){var i=e.selectedClass.indexOf(t);i==-1?e.selectedClass.push(t):e.selectedClass.splice(i,1),e.selectedClass.length?$("#stage").attr("disabled",!0):$("#stage").removeAttr("disabled")},e.clearChoosen=function(){e.selectedClass=[],$("#stage").removeAttr("disabled")},e.chooseCourse=function(t){var i=e.selectedCourse.indexOf(t);i==-1?e.selectedCourse.push(t):e.selectedCourse.splice(i,1)},e.confirm=function(){if(!e.goodName||!$(".end-date").val())return void alert("请填写完整信息!");if(e.tagIds=[],e.tagIds=e.tagIds.concat(e.stageId).concat(e.selectedClass).concat(e.selectedCourse),0==e.gid){var i={goodsName:e.goodName,price:e.totalPrice,classificationId:1e5,validityEndTime:$(".end-date").val(),tagId:e.tagIds,paperList:e.paperList};t.post(api_url+"/goods",i).success(function(e){e.status||(alert("发布商品成功!"),s.path("paper/public"))})}else{e.postTags=[],angular.forEach(e.tagIds,function(t){e.someTagIds.indexOf(t)==-1&&e.postTags.push(t)}),e.deleteTags=[],angular.forEach(e.someTagIds,function(t){e.tagIds.indexOf(t)==-1&&e.deleteTags.push(t)});var i={goodsId:e.gid,goodsName:e.goodName,price:e.totalPrice,validityEndTime:$(".end-date").val(),tagAdd:e.postTags,tagDelete:e.deleteTags,paperList:e.paperList};t.put(api_url+"/goods",i).success(function(e){e.status||(alert("发布商品成功!"),s.path("paper/public"))})}}}]),app.controller("paperPublic",["$scope","$http","$cookieStore","$location",function(e,t,i,s){e.tid=i.get("user").tid,e.currentPage=1,e.pageSize=10,t.get(api_url+"/tag/public/stage/grade").success(function(t){e.tags=t.stageList,angular.forEach(e.tags,function(t){100002==t.tagId&&(e.gradeList=t.gradeList)})}),t.get(api_url+"/tag?isPublic=1&tagType=3&isUse=1&page=1&size=1000").success(function(t){e.courses=t.tagList}),t.get(api_url+"/tag?isPublic=1&tagType=7&isUse=1&page=1&size=1000").success(function(t){e.versionList=t.tagList}),t.get(api_url+"/tag?isPublic=1&tagType=8&isUse=1&page=1&size=1000").success(function(t){e.typeList=t.tagList}),e.selectedGrade=[],e.selectedCourse=[],e.selectedVersion=[],e.selectedPaperType=[],e.stageId=100002,e.getStage=function(t,i){e.payQuestion=i,e.stageId!=t&&(e.stageId=t,e.gradeList=[],e.selectedGrade=[],e.shareType=!1,e.tagIds=[],e.tagIds=e.tagIds.concat(e.selectedCourse).concat(e.stageId),e.currentPage=1,e.payQuestion?e.getGoodsData():e.getFreeDate(),angular.forEach(e.tags,function(i){i.tagId==t&&(e.gradeList=i.gradeList)}))},e.myShare=!1,e.freeQuestion=!0,e.payQuestion=!1,e.getMain=function(){e.gradeList=[],e.selectedCourse=[],e.selectedGrade=[],e.stageId="",e.currentPage=1,e.getData(),e.myShare=!0,e.freeQuestion=!1,e.payQuestion=!1},e.changeFreeType=function(){e.myShare=!1,e.freeQuestion=!0,e.payQuestion=!1,e.stageId=100002,e.gradeList=[],e.selectedGrade=[],e.shareType=!1,e.tagIds=[],e.tagIds=e.tagIds.concat(e.selectedCourse).concat(e.stageId),e.currentPage=1,e.getFreeDate(),angular.forEach(e.tags,function(t){100002==t.tagId&&(e.gradeList=t.gradeList)})},e.changePayType=function(){e.myShare=!1,e.freeQuestion=!1,e.payQuestion=!0,e.stageId=100002,e.gradeList=[],e.selectedGrade=[],e.shareType=!1,e.tagIds=[],e.tagIds=e.tagIds.concat(e.selectedCourse).concat(e.stageId),e.currentPage=1,e.getGoodsData(),angular.forEach(e.tags,function(t){100002==t.tagId&&(e.gradeList=t.gradeList)})},e.chooseGrade=function(t,i){e.payQuestion=i;var s=e.selectedGrade.indexOf(t);s==-1?e.selectedGrade.push(t):e.selectedGrade.splice(s,1),e.tagIds=[],e.tagIds=e.tagIds.concat(e.selectedPaperType).concat(e.selectedVersion).concat(e.selectedCourse).concat(e.selectedGrade).concat(e.stageId),e.currentPage=1,e.payQuestion?e.getGoodsData():e.getFreeDate()},e.chooseCourse=function(t,i){e.payQuestion=i;var s=e.selectedCourse.indexOf(t);s==-1?e.selectedCourse.push(t):e.selectedCourse.splice(s,1),e.tagIds=[],e.tagIds=e.tagIds.concat(e.selectedPaperType).concat(e.selectedVersion).concat(e.selectedCourse).concat(e.selectedGrade).concat(e.stageId),e.currentPage=1,e.payQuestion?e.getGoodsData():e.getFreeDate()},e.chooseVersion=function(t,i){e.payQuestion=i;var s=e.selectedVersion.indexOf(t);s==-1?e.selectedVersion.push(t):e.selectedVersion.splice(s,1),e.tagIds=[],e.tagIds=e.tagIds.concat(e.selectedPaperType).concat(e.selectedVersion).concat(e.selectedCourse).concat(e.selectedGrade).concat(e.stageId),e.currentPage=1,e.payQuestion?e.getGoodsData():e.getFreeDate()},e.choosePaperType=function(t,i){e.payQuestion=i;var s=e.selectedPaperType.indexOf(t);s==-1?e.selectedPaperType.push(t):e.selectedPaperType.splice(s,1),e.tagIds=[],e.tagIds=e.tagIds.concat(e.selectedPaperType).concat(e.selectedVersion).concat(e.selectedCourse).concat(e.selectedGrade).concat(e.stageId),e.currentPage=1,e.payQuestion?e.getGoodsData():e.getFreeDate()},e.next=function(t){e.payQuestion=t,e.currentPage<e.num&&(e.currentPage++,e.shareType?e.getData():e.payQuestion?e.getGoodsData():e.payQuestion||e.getFreeDate())},e.prev=function(t){e.payQuestion=t,e.currentPage>1&&(e.currentPage--,e.shareType?e.getData():e.payQuestion?e.getGoodsData():e.payQuestion||e.getFreeDate())},e.getData=function(){t.get(api_url+"/goods/paper/teacher?type=0&page="+e.currentPage+"&size="+e.pageSize).success(function(t){e.count=t.count,0==e.count?(e.num=1,e.goodslist=[]):(e.num=Math.ceil(e.count/e.pageSize),e.goodslist=t.goodsList,angular.forEach(e.goodslist,function(e){e.show=!1}))})},e.getGoodsData=function(){t.get(api_url+"/goods/paper/shop?tagId=["+e.tagIds+"]&page="+e.currentPage+"&size="+e.pageSize).success(function(t){t.status?(e.num=1,e.goodslist=[],e.paperDate=!0):(e.count=t.count,0==e.count?(e.num=1,e.goodslist=[],e.paperDate=!0):(e.paperDate=!1,e.num=Math.ceil(e.count/e.pageSize),e.goodslist=t.goodsList,angular.forEach(e.goodslist,function(e){e.show=!1})))})},e.paperDate=!1,e.tagIds=[100002],e.getFreeDate=function(){t.get(api_url+"/question/bank/paper/list?tagId=["+e.tagIds+"]&page="+e.currentPage+"&size="+e.pageSize).success(function(t){e.dataStatus=t.status,0==e.dataStatus?(e.paperDate=!1,e.count=t.count,0==e.count?(e.num=1,e.freeList=[]):(e.num=Math.ceil(e.count/e.pageSize),e.freeList=t.paperList,angular.forEach(e.freeList,function(e){e.show=!1}))):(e.num=1,e.freeList=[],e.paperDate=!0)})},e.getFreeDate(),e.toggle=function(i,s){e.goodslist[s].show?e.goodslist[s].show=!1:(angular.forEach(e.goodslist,function(e){e.show=!1}),e.goodslist[s].show=!0),t.get(api_url+"/goods/paper/list?goodsId="+i).success(function(t){e.paperlist=t.paperList})},e.changePayShowType=function(){e.payShowType=!e.payShowType},e.changeFreeShowType=function(){e.freeShowType=!e.freeShowType}}]),app.controller("paperName",["$scope","$http","$cookieStore","$location","$routeParams",function(e,t,i,s,a){e.tid=i.get("user").tid,e.size=12,e.tagList=[],e.getTagList=function(){t.get(api_url+"/tag/test/paper/achieve?pid="+a.pid+"&page=1&size=9999").success(function(t){e.oldList=t.tagList,e.tagList=e.tagList.concat(e.oldList),e.oldTagIds=[],e.oldIds=[],angular.forEach(e.oldList,function(t){e.oldTagIds.push(t.tagId),e.oldIds.push(t.id)}),e.uploadArr()})},a.pid&&(t.get(api_url+"/test/paper?pid="+a.pid).success(function(t){e.pname=t.paperName}),e.getTagList()),e.getPublic=function(){t.get(api_url+"/tag?isPublic=1&tagType=5&page="+e.publicPage+"&size="+e.size).success(function(t){e.publicTagList=e.publicTagList.concat(t.tagList),e.publicPage*e.size<t.count?e.publicMore=!0:e.publicMore=!1})},e.morePublic=function(){e.publicPage++,e.getPublic()},e.getPrivate=function(){t.get(api_url+"/tag?isPublic=0&tagType=5&page="+e.privatePage+"&size="+e.size).success(function(t){e.privateTagList=e.privateTagList.concat(t.tagList),e.privatePage*e.size<t.count?e.privateMore=!0:e.privateMore=!1})},e.morePrivate=function(){e.privatePage++,e.getPrivate()},e.newTag=function(){if(e.addTagName){if(e.addTagName.length>8)return void alert("标签不能超过八个字!");t.post(api_url+"/tag",{isPublic:0,tagType:5,tagName:e.addTagName}).success(function(t){t.status||(e.privatePage=1,e.privateTagList=[],e.getPrivate())})}e.addTag=!1,e.addTagName=""},e.deleteTag=function(t){e.tagList.splice(t,1),e.uploadArr()},e.openModal=function(){e.tagModal=!0,e.publicPage=1,e.privatePage=1,e.publicTagList=[],e.privateTagList=[],e.getPublic(),e.getPrivate(),e.tempTagArr=[],e.tempTagArr=e.tempTagArr.concat(e.tagList),e.uploadArr()},e.chooseTag=function(t){var i=e.selectedTagIds.indexOf(t.tagId);i==-1?(e.tempTagArr.push(t),e.selectedTagIds.push(t.tagId)):(e.tempTagArr.splice(i,1),e.selectedTagIds.splice(i,1))},e.uploadArr=function(){e.selectedTagIds=[],e.selectedIds=[],angular.forEach(e.tagList,function(t){e.selectedTagIds.push(t.tagId),e.selectedIds.push(t.id)})},e.hideModal=function(){e.tagModal=!1,e.uploadArr()},e.confirm=function(){e.tagModal=!1,e.tagList=e.tempTagArr,e.uploadArr()},e.nextstep=function(){return e.pname?e.pname.length>50?void alert("试卷名不能超过50个字"):(e.pname=e.pname.trim(),void(a.pid?(e.postTags=[],angular.forEach(e.selectedTagIds,function(t){e.oldTagIds.indexOf(t)==-1&&e.postTags.push(t)}),e.deleteTags=[],angular.forEach(e.oldIds,function(t){e.selectedIds.indexOf(t)==-1&&e.deleteTags.push(t)}),t.put(api_url+"/test/paper",{pid:parseInt(a.pid),paperName:e.pname}).success(function(i){i.status||(e.postTags.length&&e.deleteTags.length?t.post(api_url+"/tag/test/paper",{pid:parseInt(a.pid),tagId:e.postTags}).success(function(i){i.status||t({method:"DELETE",url:api_url+"/tag/test/paper",data:{id:e.deleteTags},headers:{"Content-Type":"application/json;charset=utf-8"}}).success(function(e){e.status||s.path("/paper/input/"+a.pid)})}):e.postTags.length&&!e.deleteTags.length?t.post(api_url+"/tag/test/paper",{pid:parseInt(a.pid),tagId:e.postTags}).success(function(e){e.status||s.path("/paper/input/"+a.pid)}):!e.postTags.length&&e.deleteTags.length?t({method:"DELETE",url:api_url+"/tag/test/paper",data:{id:e.deleteTags},headers:{"Content-Type":"application/json;charset=utf-8"}}).success(function(e){e.status||s.path("/paper/input/"+a.pid)}):s.path("/paper/input/"+a.pid))})):t.post(api_url+"/test/paper",{paperName:e.pname,tagId:e.selectedTagIds}).success(function(e){e.status||s.path("/paper/input/"+e.pid)}))):void alert("请填写习题名!")}}]),app.controller("paperTag",["$scope","$http",function(e,t){e.publicPaperPage=1,e.privatePaperPage=1,e.publicQuestionPage=1,e.privateQuestionPage=1,e.size=12,e.publicPaperTagList=[],e.privatePaperTagList=[],e.publicQuestionTagList=[],e.privateQuestionTagList=[],e.tagType=1,e.getPaperPublic=function(){t.get(api_url+"/tag?isPublic=1&tagType=5&page="+e.publicPaperPage+"&size="+e.size).success(function(t){e.publicPaperTagList=e.publicPaperTagList.concat(t.tagList),e.publicPaperPage*e.size<t.count?e.publicPaperMore=!0:e.publicPaperMore=!1})},e.getPaperPublic(),e.morePaperPublic=function(){e.publicPaperPage++,e.getPaperPublic()},e.getPaperPrivate=function(){t.get(api_url+"/tag?isPublic=0&tagType=5&page="+e.privatePaperPage+"&size="+e.size).success(function(t){e.privatePaperTagList=e.privatePaperTagList.concat(t.tagList),e.privatePaperPage*e.size<t.count?e.privatePaperMore=!0:e.privatePaperMore=!1})},e.getPaperPrivate(),e.morePaperPrivate=function(){e.privatePaperPage++,e.getPaperPrivate()},e.newPaperTag=function(){if(e.addPaperTagName){if(e.addPaperTagName.length>8)return void alert("标签不能超过八个字!");t.post(api_url+"/tag",{isPublic:0,tagType:5,tagName:e.addPaperTagName}).success(function(t){t.status||(e.privatePaperPage=1,e.privatePaperTagList=[],e.getPaperPrivate())})}e.addPaperTag=!1,e.addPaperTagName=""},e.deletePaperTag=function(i){t({method:"DELETE",url:api_url+"/tag",data:{tagId:[i]},headers:{"Content-Type":"application/json;charset=utf-8"}}).success(function(t){t.status||(e.privatePaperPage=1,e.privatePaperTagList=[],e.getPaperPrivate())})},e.getQuestionPublic=function(){t.get(api_url+"/tag?isPublic=1&tagType=6&page="+e.publicQuestionPage+"&size="+e.size).success(function(t){e.publicQuestionTagList=e.publicQuestionTagList.concat(t.tagList),e.publicQuestionPage*e.size<t.count?e.publicQuestionMore=!0:e.publicQuestionMore=!1})},e.getQuestionPublic(),e.moreQuestionPublic=function(){e.publicQuestionPage++,e.getQuestionPublic()},e.getQuestionPrivate=function(){t.get(api_url+"/tag?isPublic=0&tagType=6&page="+e.privateQuestionPage+"&size="+e.size).success(function(t){e.privateQuestionTagList=e.privateQuestionTagList.concat(t.tagList),e.privateQuestionPage*e.size<t.count?e.privateQuestionMore=!0:e.privateQuestionMore=!1})},e.getQuestionPrivate(),e.moreQuestionPrivate=function(){e.privateQuestionPage++,e.getQuestionPrivate()},e.newQuestionTag=function(){if(e.addQuestionTagName){if(e.addQuestionTagName.length>8)return void alert("标签不能超过八个字!");var i={isPublic:0,tagType:6,tagName:e.addQuestionTagName};t.post(api_url+"/tag",i).success(function(t){t.status||(e.privateQuestionPage=1,e.privateQuestionTagList=[],e.getQuestionPrivate())})}e.addQuestionTag=!1,e.addQuestionTagName=""},e.deleteQuestionTag=function(i){t({method:"DELETE",url:api_url+"/tag",data:{tagId:[i]},headers:{"Content-Type":"application/json;charset=utf-8"}}).success(function(t){t.status||(e.privateQuestionPage=1,e.privateQuestionTagList=[],e.getQuestionPrivate())})},e.checkTagType=function(t){e.tagType=t}}]),app.controller("paperInput",["$scope","$http","$cookieStore","$location","$routeParams","$compile",function(e,t,i,s,a,r){function n(t){function i(t){if(t.lengthComputable){var i=Math.round(100*t.loaded/t.total);e.$apply(function(){e.progress=i.toString()+"%"})}}function s(t){$("#redactor_modal_overlay").css("display","none"),e.$apply(function(){e.tip=r.name})}var a=t.target.files,r=a[0];if(r.name.indexOf(".doc")==-1)return void alert("请上传word文件!");$("#redactor_modal_overlay").css("display","block");var n=new FormData($("#uploadPicForm")[0]);if(!a.length)return void toastr.info("请选择要上传的文件！");var o=new XMLHttpRequest;o.upload.addEventListener("progress",i,!1),o.upload.addEventListener("load",s,!1),o.open("POST",api_url+"/upload?type=3&token="+e.token),o.send(n),o.onreadystatechange=function(){4==o.readyState&&(o.status>=200&&o.status<300||304===o.status)&&(e.wordUrl=JSON.parse(o.responseText).data.url)}}e.tid=i.get("user").tid,e.token=i.get("user").token,e.pid=a.pid,t.get(api_url+"/test/paper/preview?pid="+e.pid).success(function(i){if(!i.status){if(e.paper=i.paper,e.pname=i.paper.paperName,e.questions=i.questions,e.questions)for(var s=0;s<e.questions.length;s++){var a=e.questions[s];a.qDigest&&delete a.mid}i.stem&&(e.stems=i.stem),t.get(api_url+"/tag/test/question/achieve/paper?pid="+e.pid).success(function(t){if(!t.status&&(angular.forEach(t.questions,function(t){angular.forEach(e.questions,function(e){t.qid&&e.qid&&t.qid===e.qid&&(e.tagList=t.tagList)})}),t.stem))for(var i in t.stem)angular.forEach(e.stems[i],function(e){angular.forEach(t.stem[i],function(t){e.qid==t.qid&&(e.tagList=t.tagList)})})}),e.titList=[],e.totalScore=0;var r=0;if(e.paper.paperStructJson&&0!=e.paper.paperStructJson.length){e.ans=["A","B","C","D","E","F","G","H","I","J"];for(var n=0;n<e.paper.paperStructJson.length;n++)if(e.paper.paperStructJson[n].mid)for(var o=0;o<e.paper.paperStructJson[n].stem.length;o++){e.titList[r]={};var c=e.paper.paperStructJson[n].mid;e.titList[r].list=n+1+"-"+(o+1),e.stems[c][o].qScore?e.titList[r].qScore=Number(e.stems[c][o].qScore):e.titList[r].qScore=0,e.totalScore+=e.titList[r].qScore,r++}else e.titList[r]={},e.titList[r].list=n+1,e.questions[n].qScore&&0!=e.questions[n].qScore?e.titList[r].qScore=Number(e.questions[n].qScore):e.titList[r].qScore=0,e.totalScore+=e.titList[r].qScore,r++}else $(".add-new-common").click()}}),e.toTop=function(){$("body,html").animate({scrollTop:0})},t.get(api_url+"/tag?isPublic=1&tagType=6&page=1&size=9999999").success(function(t){e.publicTagList=t.tagList}),t.get(api_url+"/tag?isPublic=0&tagType=6&page=1&size=9999999").success(function(t){e.privateTagList=t.tagList}),e.assist=function(){e.assistModal=!0,e.tip="请上传文档",e.require="",e.wordUrl="",angular.element("#file").val("")},e.wordUpload=function(){angular.element("#file").click()},document.getElementById("file").addEventListener("change",n,!1),e.confirmAssist=function(){e.wordUrl&&e.require?t.post(api_url+"/assist/test/paper/input",{applyExplain:e.require,resourcesName:e.tip,resourcesUrl:e.wordUrl}).success(function(t){t.status||(e.assistModal=!1)}):alert("请填写完善信息!")}}]),app.controller("paperPreview",["$scope","$http","$cookieStore","$routeParams","$location","mxxServices",function(e,t,i,s,a,r){e.pid=s.pid,e.back=function(){a.path("/paper/input/"+e.pid)},r.getPaperData(e),e["goto"]=function(e){var t=$(".paper-preview-detail"),i=t.find("dt:lt("+e+")"),s=0;i.size()&&$.each(i,function(e){var t=$(this).height()+20;s+=t}),t.animate({scrollTop:s})},e.confirm=function(){$("#redactor_modal_overlay").css("display","block"),t.post(api_url+"/test/paper/confirm",{pid:[Number(e.pid)]}).success(function(t){$("#redactor_modal_overlay").css("display","none"),t.status||a.path("/paper/complete/"+e.pid)})}}]),app.controller("wxPreview",["$scope","$http","$cookieStore","$routeParams","$location","mxxServices",function(e,t,i,s,a,r){
e.pid=Number(s.pid),e.back=function(){a.path("/paper/list/0")},r.getPaperData(e),e["goto"]=function(e){var t=$(".paper-preview-detail"),i=t.find("dt:lt("+e+")"),s=0;i.size()&&$.each(i,function(e){var t=$(this).height()+20;s+=t}),t.animate({scrollTop:s})};var n="http://www.maixuexi.cn/phone/#/preview/"+e.pid;r.qrCode($(".wxQrcode"),n),e.showQrcode=function(){$(".view-code").css("display","block")},e.hiddenQrcode=function(){$(".view-code").css("display","none")},e.shareModal=function(){e.myModal=!0,e.teacherName="",e.searchName=""},e.obtainPaper=function(i){e.pid=i,t.post(api_url+"/question/bank/paper/get",{pid:[e.pid]}).success(function(t){t.status||(e.myModal=!1,a.path("/paper/list/0"))})};var o=/^[a-zA-Z]\w+$/,c=/^1[34578]\d{9}$/,u=/^[\w-]+(\.[\w-]+)*@[\w-]+(\.[\w-]+)+$/;e.search=function(){if(e.searchName){var i={};if(u.test(e.searchName))i.email=e.searchName;else if(c.test(e.searchName))i.phone=e.searchName;else{if(!o.test(e.searchName))return void alert("请输入有效账号信息!");i.account=e.searchName}t.put(api_url+"/teacher/info",i).success(function(t){t.status?e.teacherName="":(e.tid=t.tid,e.teacherName=t.teacherName)})}},e.confirm=function(){e.teacherName&&t.post(api_url+"/test/paper/share",{pid:e.pid,tid:e.tid}).success(function(t){t.status||(e.myModal=!1)})},e.showShareBtn=!1,e.qid,e.mid,e.index,e.childIndex,e.shareModalBox=!1,e.goToShareList=!1,e.shareQuestion=function(t,i,s,a){e.showShareBtnQid=t,e.showShareBtn=!0,e.goToShareList=!1,e.qid=t,i&&(e.mid=i),e.index=s,a&&(e.childIndex=a),e.index=s,e.shareModalBox=!0},e.cancelShare=function(){e.showShareBtn=!1},e.confirmShare=function(){$(".noticeTime").val()?e.noticeTime=$(".noticeTime").val():e.noticeTime="";var i={};i.qid=e.qid,i.pid=e.pid,e.mid&&(i.mid=e.mid),e.noticeTime&&(i.answerShowTime=e.noticeTime),t.post(api_url+"/publish/share/question",i).success(function(t){e.sharingId=t.sharingId,e.shareModalBox=!1,e.goToShareList=!0;var i="http://www.maixuexi.cn/student/#/extend/question/share/"+e.sharingId+"?state=QuestionCenter";r.qrCode($(".shareQrcode"),i)})},e.yesSure=function(){e.goToShareList=!1,e.showShareBtn=!1}}]),app.controller("goodsPreview",["$scope","$http","$cookieStore","$routeParams","$location","mxxServices",function(e,t,i,s,a,r){e.pid=s.pid,e.gid=s.gid,r.getPaperData(e),e["goto"]=function(e){var t=$(".paper-preview-detail"),i=t.find("dt:lt("+e+")"),s=0;i.size()&&$.each(i,function(e){var t=$(this).height()+20;s+=t}),t.animate({scrollTop:s})};var n="http://www.maixuexi.cn/phone/#/preview/"+e.pid;r.qrCode($(".wxQrcode"),n),e.showQrcode=function(){$(".view-code").css("display","block")},e.hiddenQrcode=function(){$(".view-code").css("display","none")},t.get(api_url+"/goods/paper/preview?goodsId="+e.gid+"&pid="+e.pid).success(function(t){t.status||(e.goods=t,e.tagList=t.tagList,e.status=t.goodsStatus,e.shareType=t.sharingStatus,3==e.shareType?(1==e.status||4==e.status||5==e.status?e.handle="重新发布":3==e.status?e.handle="安排作业":2==e.status&&(e.handle="安排作业",e.disable=!0),e.backUrl="#/paper/public"):1==e.shareType&&3==e.status?(e.handle="安排作业",e.backUrl="#/paper/list/1"):2==e.shareType&&3==e.status&&(e.handle="获取",e.backUrl="#/paper/public"))}),e.doSomething=function(){e.disable||(3==e.shareType?3==e.status?a.path("/work/arrange/"+e.pid+"/"+e.gid):a.path("/paper/publish/0/"+e.gid):1==e.shareType&&3==e.status?a.path("/work/arrange/"+e.pid+"/"+e.gid):2==e.shareType&&3==e.status&&t.post(api_url+"/goods/paper/obtain",{goodsId:e.gid,pid:e.pid}).success(function(t){t.status||(e.handle="安排作业",e.shareType=1)}))}}]),app.controller("paperComplete",["$scope","$http","$cookieStore","$routeParams",function(e,t,i,s){e.pid=s.pid,t.get(api_url+"/test/paper/preview?pid="+e.pid).success(function(t){t.status||(e.pname=t.paper.paperName,e.questionsNum=t.paper.objNumber+t.paper.subNumber,e.questionsScore=t.paper.objScore+t.paper.subScore,e.isQuestionBank=t.paper.isQuestionBank)})}]),app.controller("paperExport",["$scope","$http","$routeParams","mxxServices",function(e,t,i,s){e.pid=i.pid;var a="http://www.maixuexi.cn/teacher/#/paper/"+e.pid;s.qrCode($(".qrcode"),a),s.getPaperData(e),e.download=function(){t.get(api_url+"/test/paper/teacher/word?pid="+e.pid).success(function(e){window.location.href=e.url})}}]),app.controller("worklist",["$scope","$http","$cookieStore",function(e,t,i){e.tid=i.get("user").tid,e.currentPage=1,e.pageSize=10,e.isAllVisible=!1,e.visible={},e.allCheck=function(){e.isAllVisible?(e.isAllVisible=!1,e.visible={}):(e.isAllVisible=!0,angular.forEach(e.worklist,function(t,i,s){e.visible[t.workId]=!0}))},e.oneCheck=function(t){if(e.visible[t])delete e.visible[t],e.isAllVisible=!1;else{e.visible[t]=this.work.workStatus;var i=0;for(key in e.visible)i++;i==e.worklist.length&&(e.isAllVisible=!0)}var s=[];for(key in e.visible)s.push(e.visible[key]);s.indexOf(6)!=-1||s.indexOf(7)!=-1?$(".revoke-exam").addClass("disabled"):$(".revoke-exam").removeClass("disabled"),s.indexOf(6)!=-1?$(".no-revoke-exam").removeClass("disabled"):$(".no-revoke-exam").addClass("disabled")},e.getData=function(){e.searchObj={},t.put(api_url+"/work/teacher/name?page="+e.currentPage+"&size="+e.pageSize,e.searchObj).success(function(t){e.count=t.count,0==e.count?e.num=1:(e.num=Math.ceil(e.count/e.pageSize),e.worklist=t.workList,angular.forEach(e.worklist,function(e,t){3==e.workStatus||5==e.workStatus||6==e.workStatus||7==e.workStatus?e.finishWork=!0:e.finishWork=!1}))})},e.getData(),e.workerStatus=["未开始","准备中","进行中","批改中","长期作业中","客观题自动批改","已结束","已撤销"],e.tid=i.get("user").tid,e.showChooseTimeBox=!1,e.chooseTimeShow=function(){e.showChooseTimeBox=!0},t.get(api_url+"/teacher/class/owner?tid="+e.tid+"&page=1&size=9999").success(function(t){e.classlistOwn=t.classList}),t.get(api_url+"/teacher/class/public?tid="+e.tid+"&page=1&size=9999").success(function(t){e.classlistPublic=t.classList}),e.cid=document.getElementById("selectCid").value,e.chooseClassId=function(){e.cid=document.getElementById("selectCid").value,e.currentPage=1},e.search=function(){return e.startTime=$(".startTime").val(),e.endTime=$(".endTime").val(),e.paperName||e.cid||e.startTime&&e.endTime?(e.searchObj={},e.paperName&&(e.searchObj.workName=e.paperName),e.cid&&0!=e.cid&&(e.searchObj.cid=e.cid),e.startTime&&(e.searchObj.startTime=e.startTime),e.endTime&&(e.searchObj.endTime=e.endTime),t.put(api_url+"/work/teacher/name?page="+e.currentPage+"&size="+e.pageSize,e.searchObj).success(function(t){t.status?alert(t.info):(e.worklist=t.workList,e.count=t.count,e.num=Math.ceil(e.count/e.pageSize))}),void 0):void alert("请选择搜索条件")},e.next=function(){e.currentPage<e.num&&(e.currentPage++,e.searchObj={},e.paperName&&(e.searchObj.workName=e.paperName),e.cid&&0!=e.cid&&(e.searchObj.cid=e.cid),e.startTime&&(e.searchObj.startTime=e.startTime),e.endTime&&(e.searchObj.endTime=e.endTime),e.search())},e.prev=function(){e.currentPage>1&&(e.currentPage--,e.searchObj={},e.paperName&&(e.searchObj.workName=e.paperName),e.cid&&0!=e.cid&&(e.searchObj.cid=e.cid),e.startTime&&(e.searchObj.startTime=e.startTime),e.endTime&&(e.searchObj.endTime=e.endTime),e.search())},document.onkeydown=function(t){var t=t||window.ev;t.keyCode&&13==t.which&&e.search()},e.mouse={mouseover:function(){$(".handle-menu").css("display","block")},mouseout:function(){$(".handle-menu").css("display","none")}},e["delete"]=function(){var i=[];for(key in e.visible)i.push(Number(key));return 0==i.length?void alert("请选择要删除的作业!"):void t({method:"DELETE",url:api_url+"/work",data:{workId:i},headers:{"Content-Type":"application/json;charset=utf-8"}}).success(function(t){t.status||(e.getData(),alert("删除作业成功!"),e.isAllVisible=!1,e.visible={})})},e.revoke=function(){if(!$(".revoke-exam").hasClass("disabled")){var i=[];for(key in e.visible)i.push(Number(key));return 0==i.length?void alert("请选择要撤销的作业!"):void t.put(api_url+"/work/is/revoke",{workId:i,isRevoke:1}).success(function(t){e.visible={},e.getData(),alert("作业撤销成功!")})}},e.noRevoke=function(){if(!$(".no-revoke-exam").hasClass("disabled")){var i=[];for(key in e.visible)i.push(Number(key));return 0==i.length?void alert("请选择要取消撤销的作业!"):void t.put(api_url+"/work/is/revoke",{workId:i,isRevoke:0}).success(function(t){e.visible={},e.getData(),alert("作业取消撤销成功!")})}}}]),app.controller("workdetail",["$scope","$http","$routeParams","$location",function(e,t,i,s){e.wid=i.wid,t.get(api_url+"/work/class?workId="+e.wid).success(function(t){e.classInfo=t["class"],e.workInfo=t,e.hours=Math.floor(e.workInfo.durationTime/3600),e.minute=Math.floor((e.workInfo.durationTime-3600*parseInt(e.hours))/60),e.second=e.workInfo.durationTime-3600*parseInt(e.hours)-60*parseInt(e.minute),e.workInfo.deleteStudents=[],e.workInfo.addStudents=[]}),e.setting=function(){$("div.switch").toggle(400)},e.getCurrentTime=function(){var t=new Date,i=t.getFullYear(),s=t.getMonth()+1,a=t.getDate(),r=t.getHours(),n=t.getMinutes(),o=t.getSeconds();s<10&&(s="0"+s),a<10&&(a="0"+a),r<10&&(r="0"+r),n<10&&(n="0"+n),o<10&&(o="0"+o),e.currentTime=i+"-"+s+"-"+a+" "+r+":"+n+":"+o},e.userCheck=function(t){if(e.getCurrentTime(),e.workInfo.endTime&&Date.parse(new Date(e.workInfo.endTime))<Date.parse(currentTime))return void alert("作业已经结束,不可以修改了!");for(var i=e.classInfo.students.length,s=0;s<i;s++)e.classInfo.students[s].studentId==t&&(1==e.classInfo.students[s].isMake?(e.classInfo.students[s].isMake=0,e.workInfo.deleteStudents.push(t),e.workInfo.addStudents.indexOf(t)!=-1&&e.workInfo.addStudents.splice(e.workInfo.addStudents.indexOf(t),1)):(e.classInfo.students[s].isMake=1,e.workInfo.addStudents.push(t),e.workInfo.deleteStudents.indexOf(t)!=-1&&e.workInfo.deleteStudents.splice(e.workInfo.deleteStudents.indexOf(t),1)))},e.isAll=function(){return e.getCurrentTime(),e.workInfo.endTime&&Date.parse(new Date(e.workInfo.endTime))<Date.parse(currentTime)?void alert("作业已经结束,不可以修改了!"):void(1==e.workInfo.isWholeWork?e.workInfo.isWholeWork=2:e.workInfo.isWholeWork=1)},e.submit=function(){if(e.getCurrentTime(),$(".second").val()?e.second=parseInt(e.second):e.second=0,e.durationTime=3600*e.hours+60*e.minute+e.second,$(".startime").val()?e.workInfo.startTime=$(".startime").val():e.workInfo.startTime=e.currentTime,$(".noticeTime").val()?e.workInfo.displayTime=$(".noticeTime").val():e.workInfo.displayTime=e.currentTime,$(".endtime").val()){if(Date.parse(new Date($(".endtime").val()))<Date.parse(new Date(e.workInfo.startTime)))return void alert("请正确填写开始结束时间!");e.workInfo.endTime=$(".endtime").val()}else e.workInfo.endTime=null;var i=new Date($(".startime").val()).getTime();if($(".endtime").val()){var a=new Date($(".endtime").val()).getTime();if((a-i)/1e3<e.durationTime)return void alert("作业时长不合法!");e.workInfo.durationTime=e.durationTime}else e.workInfo.durationTime=e.durationTime;e.workInfo.cids=[],e.workInfo.cids.push(e.classInfo),t.put(api_url+"/work",e.workInfo).success(function(e){e.status||(alert("作业修改成功!"),s.path("/work/list"))})}}]),app.controller("arrange",["$scope","$http","$location","$cookieStore","$routeParams","$window",function(e,t,i,s,a,r){e.sid=s.get("user").sid,e.tid=s.get("user").tid,e.userlist={},e.currentPage=1,e.pageSize=12,e.classTypeName=["","公共","我的"],e.pid=Number(a.pid),e.gid=Number(a.gid),e.getPaperList=function(){t.get(api_url+"/test/paper/teacher?page=1&size=99999").success(function(t){e.paperlist=t.paperList})},e.getPaperList(),e.getGoodPaperList=function(){t.get(api_url+"/goods/paper/teacher/relation?page=1&size=99999").success(function(t){e.goodsPaperlist=t.goodsList,angular.forEach(e.goodsPaperlist,function(e){e.goodsPaperName=e.paperName+"("+e.goodsName+")"})})},e.searchPaper=function(){if(!e.type){if(!e.paperName)return void t.get(api_url+"/test/paper/teacher?page=1&size=1000").success(function(t){e.paperlist=t.paperList});t.put(api_url+"/test/paper/search?page=1&size=1000",{paperName:e.paperName}).success(function(t){0==t.count?(e.getData(),alert("没有找到您要搜索的试卷!")):e.paperlist=t.paperList})}},e.pKeyup=function(t){var i=window.event?t.keyCode:t.which;13==i&&e.searchPaper()},e.visible={},e.pid&&!e.gid?(e.type=0,e.workType=1,t.get(api_url+"/test/paper?pid="+e.pid).success(function(t){e.visible[e.pid]=!0,1==t.isFinish?(e.pname=t.paperName,e.pid=t.pid,$(".checkedPaper").css("display","block")):r.history.go(-1)})):e.gid?(e.type=1,e.workType=3,t.get(api_url+"/goods/paper/preview?goodsId="+e.gid+"&pid="+e.pid).success(function(t){e.visible[e.gid]={},e.visible[e.gid][e.pid]=!0,e.pname=t.paperName+"("+t.goodsName+")",e.pid=t.pid,e.gid=t.goodsId,e.price=t.paperPrice,$(".checkedPaper").css("display","block")})):e.pid||e.gid||(e.type=0),e.getClassData=function(){e.getClassApi||(e.currentPage=1),e.getClassApi=!0,t.get(api_url+"/teacher/class/list?tid="+e.tid+"&page="+e.currentPage+"&size="+e.pageSize).success(function(t){if(!t.status){e.count=t.count,e.classlist=t.classList;for(var i=0;i<e.classlist.length;i++)e.classlist[i].className.length>25?e.classlist[i].shortClassName=e.classlist[i].className.substring(0,25)+"...":e.classlist[i].shortClassName=e.classlist[i].className;0==e.count?e.loadMore=!1:e.count>e.currentPage*e.pageSize?e.loadMore=!0:e.loadMore=!1}})},e.getClassData(),e.searchClass=function(){return e.className?(e.getClassApi&&(e.currentPage=1),e.getClassApi=!1,void t.put(api_url+"/teacher/class/search?",{className:e.className,type:2,tid:e.tid,page:e.currentPage,size:e.pageSize}).success(function(t){e.count=t.count,e.classlist=t.classList,0==e.count?e.loadMore=!1:e.count>e.currentPage*e.pageSize?e.loadMore=!0:e.loadMore=!1})):void e.getClassData()},e.getMoreClass=function(){e.currentPage++,e.getClassApi?t.get(api_url+"/teacher/class/list?tid="+e.tid+"&page="+e.currentPage+"&size="+e.pageSize).success(function(t){if(!t.status){e.count=t.count,e.classlist=e.classlist.concat(t.classList);for(var i=0;i<e.classlist.length;i++)e.classlist[i].className.length>25?e.classlist[i].shortClassName=e.classlist[i].className.substring(0,25)+"...":e.classlist[i].shortClassName=e.classlist[i].className;0==e.count?e.loadMore=!1:e.count>e.currentPage*e.pageSize?e.loadMore=!0:e.loadMore=!1}}):(e.getClassApi=!1,t.put(api_url+"/teacher/class/search?",{className:e.className,type:2,tid:e.tid,page:e.currentPage,size:e.pageSize}).success(function(t){e.count=t.count,e.classlist=e.classlist.concat(t.classList),0==e.count?e.loadMore=!1:e.count>e.currentPage*e.pageSize?e.loadMore=!0:e.loadMore=!1}))},e.cKeyup=function(t){var i=window.event?t.keyCode:t.which;13==i&&e.searchClass()},e.check=function(t,i){e.type?e.visible[i]&&e.visible[i][t]?(delete e.visible[i][t],$(".checkedPaper").css("display","none")):(e.visible={},e.visible[i]={},e.visible[i][t]=!0,$(".checkedPaper").css("display","block"),e.pname=this.paper.paperName+"("+this.paper.goodsName+")",e.pid=this.paper.pid,e.gid=this.paper.goodsId,e.price=this.paper.paperPrice):e.visible[t]?(delete e.visible[t],$(".checkedPaper").css("display","none")):(e.visible={},e.visible[t]=!0,$(".checkedPaper").css("display","block"),e.pname=this.paper.paperName,e.pid=this.paper.pid)},e.checkedPaper=function(){$(".checkedPaper").css("display","none"),e.visible={}},e.checkType=function(t){e.type!=t&&(1==t?(e.workType=3,e.getGoodPaperList()):0==t&&(e.workType=1,e.getPaperList()),e.type=t,e.checkedPaper())},e.checked={},e.unchecked={},e.userUnchecked={},e.classCheck=function(i,s){e.unchecked[i]?e.checked[i]&&(delete e.checked[i],e.unchecked[i]=!1,t.get(api_url+"/class/student/list?cid="+i+"&page=1&size=200").success(function(t){e.userlist[i]=t.studentList,e.userUnchecked[i]={};for(var s=0;s<e.userlist[i].length;s++){if(0==e.userlist[i].length)return void(e.userUnchecked[i]={});e.userUnchecked[i][e.userlist[i][s].studentId]=!0}})):(e.checked[i]={},$("#index"+s).css("display","block"),e.unchecked[i]=!0,e.checked[i].cid=i,e.checked[i].students=[],e.userUnchecked[i]={},t.get(api_url+"/class/student/list?cid="+i+"&page=1&size=1000").success(function(t){if(e.userlist[i]=t.studentList,0==e.userlist[i].length)e.checked[i].students=[];else for(var s=0;s<e.userlist[i].length;s++)e.checked[i].students.push({studentId:e.userlist[i][s].studentId,isMake:1})})),e.userCheck=function(i,s){if(e.userUnchecked[i]||(e.userUnchecked[i]={}),e.userUnchecked[i][s])delete e.userUnchecked[i][s],e.checked[i]||(e.checked[i]={},e.checked[i].cid=i,e.checked[i].students=[],t.get(api_url+"/class/student/list?cid="+i+"&page=1&size=200").success(function(t){if(e.userlist[i]=t.studentList,0==e.userlist[i].length)e.checked[i].students=[];else for(var a=0;a<e.userlist[i].length;a++)e.checked[i].students.push({studentId:e.userlist[i][a].studentId,isMake:0});angular.forEach(e.checked[i].students,function(e){e.studentId==s&&(e.isMake=1)})}),e.unchecked[i]=!0),angular.forEach(e.checked[i].students,function(e){e.studentId==s&&(e.isMake=1)});else if(!e.userUnchecked[i][s]&&(e.userUnchecked[i][s]=!0,e.checked[i])){var a=[];angular.forEach(e.checked[i].students,function(e){e.studentId==s&&(e.isMake=0),a.push(e.isMake)}),a.indexOf(1)==-1&&(e.unchecked[i]=!1,delete e.checked[i])}}},e["switch"]=function(e){$("#index"+e).toggle()},e.setting=function(){$("div.switch").toggle(400)},e.isall=!0,e.isWholeWork=1,e.isAll=function(){e.isall=!e.isall,e.isall?e.isWholeWork=0:e.isWholeWork=1},e.isorder=!1,e.isMixed=0,e.isOrder=function(){e.isorder=!e.isorder,e.isorder?e.isMixed=1:e.isMixed=0},e.issee=!0,e.showAnswerType=1,e.isSee=function(){return $(".endtime").val()?(e.issee=!e.issee,void(e.issee?e.showAnswerType=1:e.showAnswerType=2)):void alert("长期作业默认交卷查看解析,请设置为有限期作业后继续设置")},e.isjoin=!0,e.isJoinStatistics=1,e.isJoin=function(){e.isjoin=!e.isjoin,e.isjoin?e.isJoinStatistics=1:e.isJoinStatistics=0},e.hours=0,e.minute=0,e.second=0,e.submit=function(){if(!e.pname)return void alert("请选择试卷!");e.cids=[];for(key in e.checked)e.cids.push(e.checked[key]);if(0==e.cids.length)return void alert("请选择要布置作业的班级!");if(e.durationTime=parseInt(60*e.hours*60)+parseInt(60*e.minute)+parseInt(e.second),0!=e.durationTime&&e.durationTime<60)return void alert("作业时长不得小于1分钟!");var s=new Date,a=s.getFullYear(),r=s.getMonth()+1,n=s.getDate(),o=s.getHours(),c=s.getMinutes(),u=s.getSeconds();if(r<10&&(r="0"+r),n<10&&(n="0"+n),o<10&&(o="0"+o),c<10&&(c="0"+c),u<10&&(u="0"+u),e.currentTime=a+"-"+r+"-"+n+" "+o+":"+c+":"+u,$(".startime").val()?e.startTime=$(".startime").val():e.startTime=e.currentTime,$(".endtime").val()){if(Date.parse(new Date($(".endtime").val()))<Date.parse(new Date(e.startTime)))return void alert("请正确填写开始结束时间!");e.endTime=$(".endtime").val()}else e.endTime=null,e.showAnswerType=1;if($(".noticeTime").val()){if(Date.parse(new Date($(".noticeTime").val()))<Date.parse(new Date(e.currentTime)))return void alert("请正确填写作业通知时间!");if(Date.parse(new Date($(".noticeTime").val()))>Date.parse(new Date(e.startTime)))return void alert("请选择早于作业开始时间的通知时间!");e.displayTime=$(".noticeTime").val()}else e.displayTime=e.currentTime;var p=new Date($(".startime").val()).getTime();if($(".endtime").val()){var l=new Date($(".endtime").val()).getTime();if((l-p)/1e3<e.durationTime)return void alert("作业时长不合法!")}var d={pid:parseInt(e.pid),workName:e.pname,displayTime:e.displayTime,startTime:e.startTime,endTime:e.endTime,showAnswerType:parseInt(e.showAnswerType),durationTime:parseInt(e.durationTime),isMixed:parseInt(e.isMixed),isWholeWork:parseInt(e.isWholeWork),isJoinStatistics:parseInt(e.isJoinStatistics),cids:e.cids,workType:e.workType};e.type&&(d.goodsId=e.gid),d=JSON.stringify(d),t.post(api_url+"/work",d).success(function(e){e.status||(alert("作业布置成功!"),i.path("/work/list"))})}}]),app.controller("workcorrect",["$scope","$routeParams","$http","$filter","toolServices","$cookieStore","$timeout","correctService",function(e,t,i,s,a,r,n,o){e.workId=parseInt(t.workId),e.baseInfo={},e.paperQuestions=[],e.subjectiveQuestions=[],e.objectiveQuestions=[],e.currentQuestion={},e.currentStudent={},e.currentStudentIndex=0,e.corrected=[],e.uncorrected=[],e.questions=[],e.composites=[],e.tixus=[],e.startCorrect=1,e.isShowQuestionInfo=1,e.finalScore=0;var c=r.get("user");e.token=c.token,e.messageType=1,e.studentSort=function(t,i){angular.forEach(t,function(t){o.getStudentQidInfo(e.workId,e.currentQuestion.qid,t.studentId).then(function(e){t.workId=e.workId,t.qid=e.qid,t.qType=e.qType,t.answer=e.answer,t.submitTime=e.submitTime,t.answerDuration=e.answerDuration,t.tid=e.tid,t.tutorId=e.tutorId,t.correct=e.correct,t.correctTime=e.correctTime,t.score=e.score,t.isRight=e.isRight,t.correctType=e.correctType,t.createTime=e.createTime,t.updateTime=e.updateTime})}),e.students=t,e.currentStudentIndex=i,e.currentStudent=e.students[e.currentStudentIndex]},e.isDisplayText=function(){e.textArr=[]},o.getWorkBaseInfo(e.workId).then(function(t){e.baseInfo=t,e.baseInfo.endTime?e.baseInfo.unlimited=0:e.baseInfo.unlimited=1,o.preview(e.baseInfo.pid).then(function(t){e.questions=t.questions,e.stems=t.stem,e.subNumber=t.paper.subNumber,e.questions[0].qType&&2==e.questions[0].qType?e.currentSubjectiveIndex=0:e.questions[0].qType||2!=e.stems[e.questions[0].mid][0].qType?e.currentSubjectiveIndex=-1:e.currentSubjectiveIndex=0;for(var i=0;i<t.paper.paperStructJson.length;i++)if(t.paper.paperStructJson[i].qid){var s={tixu:(i+1).toString(),qid:t.paper.paperStructJson[i].qid,parentId:0,parentTixu:0};e.tixus.push(s);var a=t.paper.paperStructJson[i].qid,r=o.findObjInArray(t.questions,"qid",a);2==r.qType&&(r.tixu=s.tixu,e.subjectiveQuestions.push(r))}else if(t.paper.paperStructJson[i].mid)for(var n=t.paper.paperStructJson[i].mid.toString(),c=t.stem[n],u=0;u<t.paper.paperStructJson[i].stem.length;u++){var a=t.paper.paperStructJson[i].stem[u].toString(),s={tixu:(i+1).toString()+"-"+(u+1),qid:t.paper.paperStructJson[i].stem[u],parentId:t.paper.paperStructJson[i].mid,parentTixu:i+1};e.tixus.push(s);var p=o.findObjInArray(c,"qid",a);2==p.qType&&(p.parent=c,p.parentId=s.parentId,p.tixu=s.tixu,p.parentTixu=s.parentTixu,e.subjectiveQuestions.push(p))}if(0==e.tixus[0].parentId)e.currentQuestion=o.findObjInArray(e.questions,"qid",e.tixus[0].qid),e.currentQuestion.parentId=0,e.currentQuestion.tixu=e.tixus[0].tixu;else if(0!=e.tixus[0].parentId){var a=e.tixus[0].qid,l=e.tixus[0].parentId,d=e.tixus[0].parentTixu;e.currentQuestion=o.findObjInArray(e.stems[l.toString()],"qid",a),e.currentQuestion.parent=o.findObjInArray(e.questions,"mid",l),e.currentQuestion.parentTixu=d,e.currentQuestion.parentId=l,e.currentQuestion.tixu=e.tixus[0].tixu}o.getCorrectInfoByqid(e.workId,e.currentQuestion.qid).then(function(t){e.studentSort(t.studentList,0),2==e.currentQuestion.qType&&angular.isDefined(e.currentStudent)&&e.isDisplayText()})})}),e.textArr=[],e.showTextarea=function(t,i){e.textArr[i]=!0},e.removeTextarea=function(t,i,s){e.tindex=$(t.target).parents(".teacherAnswer").attr("data-tindex"),1==i?(e.currentStudent.correct[s].correct.textarea="",e.textArr[s]=!1,e.submitAnswer(e.tindex,"textarea",null)):2==i?($(t.target).siblings(".uploadImage").attr("src","").end().parent().hide(),e.submitAnswer(e.tindex,"picture",null)):3==i&&($(t.target).hide(),$(t.target).siblings(".decorator").hide(),e.submitAnswer(e.tindex,"audio",null))},e.playAudio=function(e){var t=$(e.target),i=t.siblings().get(1),s=t.siblings(".currentTime");i.play(),i.addEventListener("ended",function(){t.attr("src","./static/images/mp3.png")},!1);var a=parseInt(i.duration);s.text(a),i.addEventListener("timeupdate",function(){var e=parseInt(i.currentTime),t=a-e;s.text(t+" / "+a)},!1),t.attr("src","./static/images/pi_mp3.gif")},e.uploadPic=function(t,i){var s=(t.target,document.createElement("form"));s.setAttribute("enctype","multipart/form-data");var a=document.createElement("input");a.setAttribute("type","file"),a.setAttribute("name","resource"),a.click(),$(s).append(a),$(a).on("change",function(){var t=a.files[0];if(!/image\/\w+/.test(t.type))return void alert("请上传合法的图片");var n=new FormData(s);if(window.XMLHttpRequest)var o=new XMLHttpRequest;else{if(!window.AcitveXObject)throw Error("XMLHttpRequest not found");var o=new AcitveXObject("Microsoft.XMLHTTP")}var c=r.get("user"),u=c.token;o.onreadystatechange=function(){if(4==o.readyState&&200==o.status){var t=JSON.parse(o.response),s=t.data.url;e.$apply(function(){e.submitAnswer(i,"picture",s)})}},o.open("POST",api_url+"/upload?type=1&token="+u,!0),o.send(n)})},e.submitAnswer=function(t,i,s){if(t=Number(t),void 0===e.currentStudent.correct||null===e.currentStudent.correct||0===e.currentStudent.correct.length){for(var a=[],n=[],c=0,u=e.currentQuestion.choices[0].length;c<u;c++)a.push({correct:{}}),n.push(0);e.currentStudent.correct=a,e.currentStudent.correctType=n}"textarea"==i&&(null==s?delete e.currentStudent.correct[t].correct.textarea:e.currentStudent.correct[t].correct.textarea=s),"picture"==i&&(null==s?delete e.currentStudent.correct[t].correct.picture:e.currentStudent.correct[t].correct.picture=s),"score"==i&&(e.currentStudent.correct[t].score=parseInt(s)),"audio"==i&&null==s&&delete e.currentStudent.correct[t].correct.audio;for(var p=0,c=0;c<e.currentStudent.correct.length;c++){var l=e.currentStudent.correct[c].score;void 0!=l&&(p+=parseInt(l))}e.currentStudent.score=p;var d=r.get("user"),g={studentId:e.currentStudent.studentId,workId:e.workId,qid:e.currentQuestion.qid,qOrder:t+1,tid:d.tid,correct:e.currentStudent.correct[t].correct,score:e.currentStudent.correct[t].score};o.submit(JSON.stringify(g)).then(function(t){for(var i=!0,s=0,a=e.currentQuestion.choices[0].length;s<a;s++)if(void 0==e.currentStudent.correct[s].score){i=!1;break}1==i&&(e.currentStudent.type=1,e.currentStudent.score=p,e.students[e.currentStudentIndex]=e.currentStudent)})},e.submitText=function(t,i){var s=$(t.target).val();e.submitAnswer(i,"textarea",s)},e.submitScore=function(t,i){var s=$(t.target).val(),a=e.currentQuestion.choices[1][i];if(""!=$.trim(s)){if(!/^\d+$/.test(s))return void $(t.target).parent().parent().siblings(".highScoreTip").text("*提示:请输入合法值").show();if($(t.target).parent().parent().siblings(".highScoreTip").hide(),parseInt(s)>a)return void $(t.target).parent().parent().siblings(".highScoreTip").text("*提示:分数不可高于本空最高分").show();$(t.target).parent().parent().siblings(".highScoreTip").hide(),$(t.target).val("").parent().siblings(".score").removeClass("computerCorrect").show().children("span").show(),e.submitAnswer(i,"score",s)}},e.confirmScore=function(t,i){var s=$(t.target),a=s.siblings(".score_input").val();/^\d+$/.test(parseInt(a))&&(s.siblings(".score").removeClass("computerCorrect").children("span").show(),e.submitAnswer(i,"score",a))},e.selectQuestion=function(t,i){var s=t.qid,a=t.parentId,r=t.parentTixu;0!=a?(e.currentQuestion=o.findObjInArray(e.stems[a.toString()],"qid",s),e.currentQuestion.parent=o.findObjInArray(e.questions,"mid",a),e.currentQuestion.parentTixu=r,e.currentQuestion.parentId=a,e.currentQuestion.tixu=t.tixu):(e.currentQuestion=o.findObjInArray(e.questions,"qid",s),e.currentQuestion.tixu=t.tixu),$(i.target).addClass("selected").siblings().removeClass("selected"),o.getCorrectInfoByqid(e.workId,e.currentQuestion.qid).then(function(t){if(e.studentSort(t.studentList,0),2==e.currentQuestion.qType&&angular.isDefined(e.currentStudent)){e.isDisplayText();for(var i=0;i<e.subjectiveQuestions.length;i++)e.currentQuestion.qid==e.subjectiveQuestions[i].qid&&(e.currentSubjectiveIndex=i)}})},e.showMiddle=function(e){var t=$(e.target),i=t.siblings(".middle");t.hide(),i.show(),i.on("mouseover",function(){$(this).show(),t.hide()}),i.on("mouseout",function(){$(this).hide(),t.show()}),t.on("mouseout",function(){i.hide(),t.show()})},e.changeMessageType=function(){1==e.messageType?e.messageType=2:e.messageType=1},e.finishCorrect=function(){!function(){var t,i=$(window).width(),s=$(window).height(),a=(i-340)/2,r=(s-200)/2;t=!e.baseInfo.unlimited&&Date.parse(new Date)<Date.parse(e.baseInfo.endTime)?'<div id="popupBox" style="width:340px;height:200px;border:1px solid #d3d3d3;position:fixed;top:'+r+"px;left:"+a+'px;background:#fff;;z-index:99999;border-radius:4px;"><p style="font-size:14px;color:#797979;margin:25px;margin-top:40px;">考试未结束，还未到出答案时间!！</p><div style="margin-left:25px;margin-right:25px;"><a style="width:120px;height:33px;background:#e4e4e4;display:block;text-align:center;line-height:33px;float:left;cursor:pointer;" id="thanks">取消</a><a style="width:120px;height:33px;background:#009e4d;display:block;text-align:center;line-height:33px;float:right;color:#fff;cursor:pointer;" id="thanks-again" >确定</a></div></div>':'<div id="popupBox" style="width:340px;height:200px;border:1px solid #d3d3d3;position:fixed;top:'+r+"px;left:"+a+'px;background:#fff;;z-index:99999;border-radius:4px;"><p style="font-size:14px;color:#797979;margin:25px;margin-top:40px;">此操作完成后,每位学生将收到本次作业的成绩报告,确定要执行吗?！</p><div style="margin-left:25px;margin-right:25px;"><a style="width:120px;height:33px;background:#e4e4e4;display:block;text-align:center;line-height:33px;float:left;cursor:pointer;" id="thanks">取消</a><a style="width:120px;height:33px;background:#009e4d;display:block;text-align:center;line-height:33px;float:right;color:#fff;cursor:pointer;" id="doBigSave" >确定</a></div></div>',$("body").append(t),$("#thanks").click(function(){$("#popupBox").remove()}),$("#thanks-again").click(function(){$("#popupBox").remove()}),$("#doBigSave").click(function(){$("#popupBox").remove(),o.changeWorkStatus(e.workId,e.messageType).then(function(e){})})}()},e.getOneQuestionCorrectInfo=function(t,i){o.getCorrectInfoByqid(e.workId,t).then(function(t){e.studentSort(t.studentList,i),e.isDisplayText()})},e.prevSub=function(){if(e.currentSubjectiveIndex-=1,e.currentSubjectiveIndex<0)return void(e.currentSubjectiveIndex=0);e.currentQuestion=e.subjectiveQuestions[e.currentSubjectiveIndex],e.currentQuestion.parent=o.findObjInArray(e.questions,"mid",e.currentQuestion.parentId);for(var t=e.currentQuestion.tixu,i=$(".sort_list li"),s=0;s<i.length;s++)$.trim(i.eq(s).text())==t&&i.eq(s).addClass("selected").siblings().removeClass("selected");$(".highScoreTip").hide(),e.getOneQuestionCorrectInfo(e.currentQuestion.qid,0)},e.nextSub=function(){if(e.currentSubjectiveIndex+=1,e.currentSubjectiveIndex>=e.subjectiveQuestions.length)return void(e.currentSubjectiveIndex=e.subjectiveQuestions.length-1);e.currentQuestion=e.subjectiveQuestions[e.currentSubjectiveIndex],e.currentQuestion.parent=o.findObjInArray(e.questions,"mid",e.currentQuestion.parentId);for(var t=e.currentQuestion.tixu,i=$(".sort_list li"),s=0;s<i.length;s++)$.trim(i.eq(s).text())==t&&i.eq(s).addClass("selected").siblings().removeClass("selected");$(".highScoreTip").hide(),e.getOneQuestionCorrectInfo(e.currentQuestion.qid,0)},e.prevUser=function(){return e.currentStudentIndex-=1,e.currentStudentIndex<0?void(e.currentStudentIndex=0):($(".highScoreTip").hide(),void o.getCorrectInfoByqid(e.workId,e.currentQuestion.qid).then(function(t){e.currentStudent=e.students[e.currentStudentIndex]}))},e.nextUser=function(){return e.currentStudentIndex+=1,e.currentStudentIndex>=e.students.length?void(e.currentStudentIndex=e.students.length-1):($(".highScoreTip").hide(),void o.getCorrectInfoByqid(e.workId,e.currentQuestion.qid).then(function(t){e.currentStudent=e.students[e.currentStudentIndex]}))},e.toggleQuestionInfo=function(){e.isShowQuestionInfo=1==e.isShowQuestionInfo?0:1},e.selectUser=function(t,i){e.startCorrect=1,e.currentStudentIndex=i,e.currentStudent=e.students[i],e.isDisplayText(),$(".highScoreTip").hide(),$(".student_list").children("[data-studentId="+t+"]").addClass("active").siblings().removeClass("active")},e.zoomImg=function(e){var t=($("body").width(),$(e.target)),i=t.attr("src");i=i.replace("mini_","");var s='<div id="zoomImageOverlay" style="position:fixed;top:0;left:0;width:100%;height:100%;background:black;opacity:0.75;text-align:center;z-index:9999;"></div><div id="zoomImageBox"style="position:absolute;top:0;left:0;z-index:99999;text-align:center;width:100%;"><img title="点击旋转图片" src="'+i+'" style="max-width:1200px;cursor:pointer;margin-top:40px;background:#fff;"/><span id="zoomImageBoxCloseBtn" style="width:36px;height:36px;border-radius:18px;cursor:pointer;text-align:center;line-height:36px;color:#fff;position:fixed;top:10px;right:50px;font-size:26px;border:1px solid #fff; ">X</span></div>';$("body").append(s).scrollTop(0),$("#zoomImageBoxCloseBtn").click(function(){
$("#zoomImageBox").remove(),$("#zoomImageOverlay").remove()});var a=0;$("#zoomImageBox").children("img").click(function(){a+=90,$("#zoomImageBox").children("img").css({transform:"rotate(+"+a+"deg)","-webkit-transform":"rotate(+"+a+"deg)","-moz-transform":"rotate(+"+a+"deg)"})})},$(document).on("keydown",function(t){var i=t.which;40==i&&e.nextUser(),38==i&&e.prevUser(),37==i&&e.prevSub(),39==i&&e.nextSub()})}]),app.controller("setting",["$scope","$http","$cookieStore","$interval",function(e,t,i,s){function a(i){function s(t){e.flag=!0}var a=i.target.files,r=a[0],n=1048576;if(r.size/n>10)return void toastr.info("图片大小超出了限制!");var o=new FormData($("#uploadPicForm")[0]);if(!a.length)return void alert("请选择要上传的图片！");e.flag=!1;var c=new XMLHttpRequest;c.upload.addEventListener("load",s,!1),c.open("POST",api_url+"/upload?w=120&h=120&type=1&token="+e.token),c.send(o),c.onreadystatechange=function(){4==c.readyState&&(c.status>=200&&c.status<300||304===c.status)&&(e.$apply(function(){e.teacher.photo=JSON.parse(c.responseText).data.url}),t.put(api_url+"/teacher",{photo:e.teacher.photo,tid:e.tid}).success(function(e){!e.status}))}}e.tid=i.get("user").tid,e.token=i.get("user").token,e.getInfo=function(){t.get(api_url+"/teacher?tid="+e.tid).success(function(t){e.teacher=t,e.uid=t.uid})},e.getInfo(),e.editName=function(){e.teacher.teacherName&&t.put(api_url+"/teacher",{teacherName:e.teacher.teacherName,tid:e.tid}).success(function(e){!e.status})},e.editNumber=function(t){e.myModal=!0,e.numberModal=!0,e.validate=!0,e.editType=t},e.getPicCaptcha=function(){t.get(api_url+"/image/code?w=100&h=40").success(function(t){e.image=t.image,e.key=t.codeKey})},e.validatePwd=function(){e.password&&(e.md5Pwd=hex_md5(e.password),e.md5Pwd=e.md5Pwd.split(""),e.md5Pwd[5]=e.password.charAt(0),e.md5Pwd[10]=e.password.charAt(1),e.md5Pwd[15]=e.password.charAt(2),t.post(api_url+"/user/confirmation",{uid:e.uid,password:e.md5Pwd.join("")}).success(function(t){t.status||(e.validate=!1,1==e.editType&&e.getPicCaptcha())}))};var r=/^[a-zA-Z]\w+$/,n=/^1[34578]\d{9}$/,o=/^[\w-]+(\.[\w-]+)*@[\w-]+(\.[\w-]+)+$/;e.setTimer=function(){e.second=60,e.timer=null,e.timer=s(function(){e.second--,0==e.second&&s.cancel(e.timer)},1e3)},e.getCaptcha=function(){if(1==e.editType){if(!e.phoneCaptcha)return void alert("请输入图片验证码!");e.newPhone&&n.test(e.newPhone)?t.put(api_url+"/user/only",{phone:e.newPhone}).success(function(i){i.status||t.post(api_url+"/captcha/create",{isRegister:1,phone:e.newPhone,code:e.phoneCaptcha,codeKey:e.key}).success(function(t){t.status||e.setTimer()})}):alert("请填写正确的手机号!")}else 2==e.editType&&(e.newMail&&o.test(e.newMail)?t.put(api_url+"/user/only",{email:e.newMail}).success(function(i){i.status||t.post(api_url+"/email/captcha/create",{email:e.newMail}).success(function(t){t.status||e.setTimer()})}):alert("请填写正确的邮箱账号!"))},e.confirmEdit=function(){1==e.editType?t.put(api_url+"/modify/phone",{uid:e.uid,phone:e.newPhone,captcha:e.phonePwd}).success(function(t){t.status||(e.teacher.phone=e.newPhone,e.hideModal())}):2==e.editType?t.put(api_url+"/modify/email",{uid:e.uid,email:e.newMail,captcha:e.mailPwd}).success(function(t){t.status||(e.teacher.email=e.newMail,e.hideModal())}):3==e.editType&&e.newAccount&&r.test(e.newAccount)&&t.put(api_url+"/modify/account",{uid:e.uid,account:e.newAccount}).success(function(t){t.status||(e.teacher.account=e.newAccount,e.hideModal())})},e.hideModal=function(){e.myModal=!1,e.numberModal=!1,e.tagModal=!1,s.cancel(e.timer),e.second=0,e.password="",e.phonePwd="",e.mailPwd="",e.newMail="",e.newPhone="",e.newAccount=""},e.getTeacherTag=function(){t.get(api_url+"/tag/teacher?tid="+e.tid).success(function(t){e.teacherTags=[],e.courseTags=[],angular.forEach(t.tagList,function(t){1==t.tagType?angular.forEach(t.childList,function(i){i.tagName=t.tagName+i.tagName,e.teacherTags.push(i)}):3==t.tagType&&e.courseTags.push(t)})})},e.getTeacherTag(),t.get(api_url+"/tag/public/stage/grade").success(function(t){e.tags=t.stageList}),t.get(api_url+"/tag?isPublic=1&tagType=3&isUse=1&page=1&size=1000").success(function(t){e.courses=t.tagList}),e.editPhoto=function(){$("#file").click()},e.flag=!0,document.getElementById("file").addEventListener("change",a,!1),e.deleteTag=function(i){t({method:"delete",url:api_url+"/tag/teacher",data:{id:[i]},headers:{"Content-Type":"application/json;charset=utf-8"}}).success(function(t){t.status||e.getTeacherTag()})},e.modalGrade=function(){e.myModal=!0,e.tagModal=!0,e.gradeModal=!0,e.choosenTagIds=[],e.chooseTagIds=[],angular.forEach(e.teacherTags,function(t){e.choosenTagIds.push(t.tagId),e.choosenTagIds.indexOf(t.parentTagId)==-1&&e.choosenTagIds.push(t.parentTagId)}),e.chooseTagIds=e.chooseTagIds.concat(e.choosenTagIds)},e.chooseTag=function(t,i){e.choosenTagIds.indexOf(t)==-1&&(e.tagIdx=e.chooseTagIds.indexOf(t),e.tagIdx==-1?(e.chooseTagIds.push(t),e.chooseTagIds.push(i)):(e.chooseTagIds.splice(e.tagIdx,1),e.parentIdx=e.chooseTagIds.indexOf(i),e.chooseTagIds.splice(e.parentIdx,1)))},e.modalCourse=function(){e.myModal=!0,e.tagModal=!0,e.gradeModal=!1,e.choosenCourseIds=[],e.chooseCourseIds=[],angular.forEach(e.courseTags,function(t){e.choosenCourseIds.push(t.tagId)}),e.chooseCourseIds=e.chooseCourseIds.concat(e.choosenCourseIds)},e.chooseCourse=function(t){e.choosenCourseIds.indexOf(t)==-1&&(e.CourseIdx=e.chooseCourseIds.indexOf(t),e.CourseIdx==-1?e.chooseCourseIds.push(t):e.chooseCourseIds.splice(e.CourseIdx,1))},e.unique=function(t){e.n={},e.tempArr=[];for(var i=0;i<t.length;i++)e.n[t[i]]||(e.n[t[i]]=!0,e.tempArr.push(t[i]));return e.tempArr},e.confirm=function(){e.gradeModal?(e.unique(e.chooseTagIds),angular.forEach(e.choosenTagIds,function(t){e.tempArrIdx=e.tempArr.indexOf(t),e.tempArrIdx!=-1&&e.tempArr.splice(e.tempArrIdx,1)}),t.post(api_url+"/tag/teacher",{tagId:e.tempArr,tid:[e.tid]}).success(function(t){t.status||(e.hideModal(),e.getTeacherTag())})):t.post(api_url+"/tag/teacher",{tagId:e.chooseCourseIds.splice(e.choosenCourseIds.length),tid:[e.tid]}).success(function(t){t.status||(e.hideModal(),e.getTeacherTag())})}}]),app.controller("password",["$scope","$http",function(e,t){e.submit=function(){return e.newPassword&&!/^\w{6,20}$/.test(e.newPassword)&&alert("密码长度应在6-20位之间"),e.oldPassword&&e.newPassword&&e.newPassword==e.rePassword?(e.md5oldPwd=hex_md5(e.oldPassword),e.md5oldPwd=e.md5oldPwd.split(""),e.md5oldPwd[5]=e.oldPassword.charAt(0),e.md5oldPwd[10]=e.oldPassword.charAt(1),e.md5oldPwd[15]=e.oldPassword.charAt(2),e.md5newPwd=hex_md5(e.newPassword),e.md5newPwd=e.md5newPwd.split(""),e.md5newPwd[5]=e.newPassword.charAt(0),e.md5newPwd[10]=e.newPassword.charAt(1),e.md5newPwd[15]=e.newPassword.charAt(2),void t.put(api_url+"/changePassword",{oldpassword:e.md5oldPwd.join(""),newpassword:e.md5newPwd.join("")}).success(function(t){t.status||(alert("修改成功!"),e.oldPassword="",e.newPassword="",e.rePassword="")})):void alert("请填写完整信息")}}]),app.controller("account",["$scope","$http",function(e,t){t.get(api_url+"/account/statistics").success(function(t){e.account=t})}]);var myFilter=angular.module("myFilter",[]);myFilter.filter("createChoice",function(){return function(e){var t=["A","B","C","D","E","F","G","H","I","J"];if(angular.isArray(e)){var i=[];return angular.forEach(e,function(e,s,a){i.push(angular.isUndefined(t[e])?"":t[e])}),i}return angular.isUndefined(t[e])?"":t[e]}}),myFilter.filter("arraySplit",function(){return function(e,t){return angular.isArray(e)&&angular.isString(t)?e.join(t):e}}),myFilter.filter("escape2Html",function(){return function(e){if(""!==$.trim(e)){var t={lt:"<",gt:">",nbsp:" ",amp:"&",quot:'"'};return e.replace(/&(lt|gt|nbsp|amp|quot);/gi,function(e,i){return t[i]})}return e}}),myFilter.filter("timeFormat",function(){return function(e){var t=1e3*parseInt(e),i=new Date(t),s=i.getFullYear(),a=i.getMonth()+1,r=i.getDate(),n=i.getHours(),o=i.getMinutes();a<10&&(a="0"+a),r<10&&(r="0"+r),n<10&&(n="0"+n),o<10&&(o="0"+o);var c=s+"/"+a+"/"+r+" "+n+":"+o;return c}}),myFilter.filter("timeFormat1",function(){return function(e){var t=parseInt(e),i=new Date(t),s=i.getFullYear(),a=i.getMonth()+1,r=i.getDate(),n=i.getHours(),o=i.getMinutes();a<10&&(a="0"+a),r<10&&(r="0"+r),n<10&&(n="0"+n),o<10&&(o="0"+o);var c=s+"/"+a+"/"+r+" "+n+":"+o;return c}}),myFilter.filter("hmdFormat",["$filter",function(e){return function(t){var i="",s="",a="",r="";if(t>=86400)return 10==t.toString().length&&(t*=1e3),e("date")(t,"yyyy/MM/dd HH:mm:ss");if(t<60)a=t;else if(t>60&&t<3600)i=parseInt(t/60),!t%60===0&&(a=t%60);else{s=parseInt(t/3600);var n=t%3600;0==!n&&(n<60?a=n:n>60&&n<3600&&(i=parseInt(n/60),!n%60===0&&(a=n%60)))}return""==!s&&(r+=s+"小时"),""==!i&&(r+=i+"分钟"),""==!a&&(r+=a+"秒"),r}}]),myFilter.filter("timeTips",function(){return function(e){var t=parseInt(e),i=Math.ceil((new Date).getTime()/1e3)-t;return i>86400?Math.floor(i/60*60*24)+"天前":i>3600?Math.floor(i/60/60)+"小时前":i>60?Math.floor(i/60)+"分钟前":"刚刚"}}),myFilter.filter("removeHtml",function(){return function(e){return e=e.replace(/<\/?[^>]*>/g,""),e=e.replace(/[ | ]*\n/g,"\n"),e=e.replace(/ /gi,"")}}),myFilter.filter("to_trusted",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}]),myFilter.filter("imgToTrusted",["$sce",function(e){return function(t){if(angular.isString(t)){var t=t.replace(/<img.*_src=\"(.*)\".*type=\"vedio\">/,'<iframe height=498 width=510 src="$1" frameborder=0 allowfullscreen></iframe>');t=t.replace(/<img.*_src=\"(.*)\".*type=\"mp3\">/,'<audio controls src="$1" style="margin-top:24px"></audio>')}return e.trustAsHtml(t)}}]),myFilter.filter("noAnswer",function(){return function(e){return e?"":"[学生未作答]"}}),myFilter.filter("limitword",function(){return function(e,t,i,s){if(!e)return"";if(i=parseInt(i,10),!i)return e;if(e.length<=i)return e;if(e=e.substr(0,i),t){var a=e.lastIndexOf("");a!=-1&&(e=e.substr(0,a))}return e+(s||"...")}});var myService=angular.module("myServices",["myFilter"]);myService.factory("mxxServices",["$rootScope","$location","$http","$window",function(e,t,i,s){var a={qrCode:function(e,t){e.qrcode({render:"canvas",width:140,height:140,correctLevel:0,text:t})},loginQrcode:function(e,t){e.qrcode({render:"canvas",width:200,height:200,correctLevel:0,text:t})},getClassInfo:function(e){i.get(api_url+"/class/info?cid="+e.cid).success(function(t){e.password=t.password,e.className=t.className,e.limit=t.maxNumber,e.classNum=t.userNumber,e.createSid=t.sid,e.isPumping=t.isPumping||0})},showClass2WM:function(e){e.url="http://www.maixuexi.cn/student/#/my/class/all/"+e.cid},getPaperData:function(e){i.get(api_url+"/test/paper/preview?pid="+e.pid).success(function(t){if(!t.status&&(e.paper=t.paper,e.questions=t.questions,t.stem&&(e.stems=t.stem),e.isFinish=t.paper.isFinish,e.tid=t.paper.ownerTid,e.classes=[100674,100675,100676,100677,100678,100679],e.classes.indexOf(e.tid)!=-1&&(e.showShareQuestionBox=!0),e.paper.paperStructJson&&0!=e.paper.paperStructJson.length)){e.ans=["A","B","C","D","E","F","G","H","I","J"];for(var i=0;i<e.paper.paperStructJson.length;i++)if(e.paper.paperStructJson[i].mid){var s=/<img[^>]*>/gi,a=e.questions[i].mContent.match(s);if(a)for(var r=0;r<a.length;r++){var n=a[r].indexOf('_src="'),o=a[r].indexOf('"',n+6);a[r].indexOf("vedio")!=-1&&(e.questions[i].vedio_url=a[r].substring(n+6,o)+"?v=1002",e.questions[i].mContent=e.questions[i].mContent.replace(a[r],"")),a[r].indexOf("mp3")!=-1&&(e.questions[i].audio_url=a[r].substring(n+6,o),e.questions[i].mContent=e.questions[i].mContent.replace(a[r],""))}var c=e.paper.paperStructJson[i][c],u=e.stems[c];u||(u=[]);for(var p=0;p<u.length;p++){var l=[];for(key in u[p].qResolve)l.push(key);0==l.length&&(u[p].qResolve="")}}else{var l=[];for(key in e.questions[i].qResolve)l.push(key);0==l.length&&(e.questions[i].qResolve="")}}})}};return a}]),myService.factory("toolServices",[function(){var e={getKeys:function(e){var t=new Array;return angular.forEach(e,function(e,i,s){t.push(i)}),t},getRandomNum:function(e,t){var i=t-e,s=Math.random();return e+Math.round(s*i)}};return e}]),myService.directive("classInfo",[function(){return{restict:"AE",replace:!0,templateUrl:"./views/directive/classInfo.html"}}]),myService.directive("paperStruct",[function(){return{restict:"AE",replace:!0,templateUrl:"./views/directive/paperStruct.html"}}]),myService.directive("monitor",["$http","mxxServices","$timeout",function(e,t,i){return{restict:"AE",replace:!0,templateUrl:"./views/directive/monitor.html",link:function(e,t,i){}}}]),myService.directive("achive",["$http",function(e){return{restict:"AE",templateUrl:"./views/directive/stat.html",link:function(t,i,s){t.update=function(i){e.get(api_url+"/student/class/work/report?studentId="+t.uid+"&workId="+i).success(function(e){e.status||(t.workInfo=e,t.userQuesList=e.questionList)})},e.get(api_url+"/student/class/score?studentId="+t.uid+"&cid="+t.cid+"&number=5").success(function(e){if(t.worklist=e.scoreList,0!=t.worklist.length){for(var i=[],s=[],a=[],r=0;r<t.worklist.length;r++)i.push(t.worklist[r].score),s.push(t.worklist[r].avgScore),a.push(t.worklist[r].submitTime);$("#achive").highcharts({exporting:{enabled:!1},chart:{type:"spline"},title:{text:'<span style="color:#009234">成绩得分</span>/<span style="color:#bdbdbd">班级平均分</span>'},xAxis:{categories:a},yAxis:{title:{text:""}},tooltip:{crosshairs:!0,shared:!0},plotOptions:{},series:[{name:"成绩得分",color:"#009234",data:i},{name:"班级平均分",color:"#bdbdbd",data:s}]})}else $("#achive").html('<p class="norecord">该学生尚无作业提交记录</p>'),$(".paper-info").css("display","none")}),e.get(api_url+"/work/class/student/finish?cid="+t.cid+"&studentId="+t.uid+"&page=1&size=9999").success(function(e){if(!e.status){if(t.count=e.count,t.allWorkList=e.workList,!t.count)return;t.work=t.allWorkList[0],t.update(t.allWorkList[0].workId)}})}}}]),myService.directive("stat",["$http",function(e){return{restict:"AE",template:'<div class="stat" id="stat"></div>',link:function(t,i,s){e.get(api_url+"/work/question/answer?workId="+t.wid).success(function(e){var i=["A","B","C","D","E","F","G","H","I","J"];if(!e.status){t.load=!1;var s=$("#stat"),a=0;$.each(e.workList,function(e,t){if(0!=t.keyList.length){var r='<div class="stat-img" id="stat-'+a+'"></div>';s.append(r);for(var n=1==t.qType?"客观题":"主观题",o=[],c=0;c<t.keyList.length;c++)if(1==t.qType){var u=t.keyList[c].key;o.push(i[u])}else{var u=t.keyList[c].key;o.push(u)}for(var p=[],c=0;c<t.keyList.length;c++)p.push(t.keyList[c].value);if(1==t.qType){for(var l="",d=0;d<t.qAnswer.length;d++){var u=t.qAnswer[d];l+=i[u]}var g="正确答案: "+l}else var g="主观题无标准答案";$("#stat-"+a).highcharts({chart:{type:"column"},title:{text:t.qNumber+"("+n+t.score+"分)"},subtitle:{text:g},xAxis:{categories:o,crosshair:!0},yAxis:{title:{text:"人数"}},series:[{name:"统计",data:p}]}),a++}else $("#stat").html('<p class="norecord">此次作业目前尚无人提交!</p>')})}})}}}]),myService.directive("userTop",["$http","$cookieStore",function(e,t){return{restict:"AE",replace:!0,templateUrl:"./views/directive/userTop.html",link:function(e,i,s){e.userInfo=t.get("user"),$(".logout").click(function(){t.remove("loginTime")})}}}]),myService.directive("qrcode",["mxxServices",function(e){return{restict:"AE",transclude:!0,template:'<div class="qrCode"><div id="imgCode"></div><p>班级二维码</p></div>',link:function(e,t,i){$("#imgCode").qrcode({render:"canvas",width:140,height:140,correctLevel:0,text:e.url})}}}]),myService.directive("dialog",["$http","$location","mxxServices",function(e,t,i){return{restict:"AE",templateUrl:"./views/directive/dialog.html",link:function(t,s,a){t.mouse={mouseover:function(){$(".handle-menu").css("display","block")},mouseout:function(){$(".handle-menu").css("display","none")}},t.localWork=function(){t.paperName="",t.selectedTagIds=[],t.paperlist=[],e.get(api_url+"/tag/test/paper/list?page=1&size=99999").success(function(e){t.tagList=e.tagList}),e.get(api_url+"/test/paper/teacher?page=1&size=99999").success(function(e){if(t.paperlist=[],e.paperList&&0!=e.paperList.length){t.tip=!1;for(var i=0;i<e.paperList.length;i++)1==e.paperList[i].isFinish&&t.paperlist.push(e.paperList[i])}else t.tip=!0}),$(".paper-modal").css("display","block"),$(".mask").css("display","block")},t.cancel=function(){$(".paper-modal").css("display","none"),$(".mask").css("display","none")},t.selectTag=function(i){t.checked={};var s=t.selectedTagIds.indexOf(i);return s==-1?t.selectedTagIds.push(i):t.selectedTagIds.splice(s,1),0==t.selectedTagIds.length?void e.get(api_url+"/test/paper/teacher?page=1&size=99999").success(function(e){if(t.paperlist=[],e.paperList&&0!=e.paperList.length){t.tip=!1;for(var i=0;i<e.paperList.length;i++)1==e.paperList[i].isFinish&&t.paperlist.push(e.paperList[i])}else t.tip=!0}):void e.get(api_url+"/tag/test/paper?tagId=["+t.selectedTagIds+"]&page=1&size=99999").success(function(e){if(t.paperlist=[],e.paperList&&0!=e.paperList.length){t.tip=!1;for(var i=0;i<e.paperList.length;i++)1==e.paperList[i].isFinish&&t.paperlist.push(e.paperList[i])}else t.tip=!0})},t.checked={},t.oneCheck=function(e){t.checked[e]?t.checked={}:(t.checked={},t.checked[e]=!0)},t.confirm=function(){var s=[];for(key in t.checked)s.push(key);0==s.length?alert("请选择习题!"):($(".mtk-import-info").css("display","none"),$(".paper-modal").css("display","none"),$(".edui-container").css("display","none"),$(".mask").css("display","none"),$(".mtk-contenter").css("display","block"),$(".test-tag-list").css("display","none"),$(".mtk-info").css("display","block"),e.get(api_url+"/test/paper/preview?pid="+s[0]).success(function(a){if(!a.status){$(".left-input p").css("display","block"),t.paperInfo=a.paper,t.paperInfo.score=parseInt(t.paperInfo.objScore)+parseInt(t.paperInfo.subScore),t.localPaperName=a.paper.paperName,t.localPaper=a.questions,a.stem&&(t.localStems=a.stem),e.get(api_url+"/tag/test/question/achieve/paper?pid="+s[0]).success(function(e){if(!e.status&&(angular.forEach(e.questions,function(e){angular.forEach(t.localPaper,function(t){e.qid&&t.qid&&e.qid===t.qid&&(t.tagList=e.tagList)})}),e.stem))for(var i in e.stem)angular.forEach(t.localStems[i],function(t){angular.forEach(e.stem[i],function(e){t.qid==e.qid&&(t.tagList=e.tagList)})})}),$(".qrcode").children()&&$(".qrcode").empty();var r="http://www.maixuexi.cn/phone/#/preview/"+s[0];i.qrCode($(".qrcode"),r),t.paperInfo.paperStructJson&&0!=t.paperInfo.paperStructJson.length&&(t.ans=["A","B","C","D","E","F","G","H","I","J"])}}))},t.localTest=function(){t.localPaper=[],t.localStems={},e.get(api_url+"/tag/test/question/list?page=1&size=99999").success(function(e){t.testTagList=e.tagList,t.selectedTestTagIds=[],$(".mtk-import-info").css("display","none"),$(".mtk-info").css("display","none"),$(".left-input p").css("display","none"),$(".test-tag-list").css("display","block"),$(".edui-container").css("display","none"),$(".mtk-contenter").css("display","block")})},t.selectTestTag=function(i){var s=t.selectedTestTagIds.indexOf(i);return s==-1?t.selectedTestTagIds.push(i):t.selectedTestTagIds.splice(s,1),0==t.selectedTestTagIds.length?(t.localPaper=[],t.localStems={},void(t.testTip=!1)):void e.get(api_url+"/tag/test/question?tagId=["+t.selectedTestTagIds+"]").success(function(e){0==e.count?(t.testTip=!0,t.localPaper=[],t.localStems={}):(t.testTip=!1,t.localPaper=e.questions,e.stem&&(t.localStems=e.stem),t.ans=["A","B","C","D","E","F","G","H","I","J"])})}}}}]),myService.directive("uploader",["$location","$rootScope","$http",function(e,t,i){return{restict:"AE",scope:!0,templateUrl:"./views/directive/uploader.html",link:function(t,s,a){t.forward=function(){e.path("/paper/name/"+t.pid)},t.ans=["A","B","C","D","E","F","G","H","I","J"],t.preview=function(){$dt=$("#test dt");var i=$("#test dt").length;if(0==i)return void alert("请先录题...");for(var s=0;s<i;s++){var a=$($dt[s]),r=a.attr("data-type");if(3!=r){if(""==a.find("input[attr='score']").val())return alert("第"+(s+1)+"题的分数不能为空!"),void $.pinput.handle.jumpOrder(s+1);if(""==a.find("div[attr='title']").html())return alert("请填写第"+(s+1)+"的内容"),void $.pinput.handle.jumpOrder(s+1);if(1==r){if(0==a.find(".correct").length)return alert("请勾选第"+(s+1)+"的正确选项"),void $.pinput.handle.jumpOrder(s+1);for(var n=0;n<a.find(".answer").length;n++)if(""==a.find(".answer")[n].innerHTML)return alert("请填写第"+(s+1)+"的"+t.ans[n]+"选项"),void $.pinput.handle.jumpOrder(s+1)}}if(3==r){if(""==a.find("div[attr='material']").html())return alert("请填写第"+(s+1)+"的复合题材料"),void $.pinput.handle.jumpOrder(s+1);var o=a.find(".pinput-item-boder");if(0==o.length)return alert("第"+(s+1)+"题还未录完"),void $.pinput.handle.jumpOrder(s+1);for(var n=0;n<o.length;n++){var c=$(o[n]),u=c.find(".pinput-item-main .pinput-question").attr("data-type");if(""==c.find("input[attr='score']").val())return alert("第"+(s+1)+"-"+(n+1)+"题的分数不能为空!"),void $.pinput.handle.jumpOrder(s+1);if(""==c.find("div[attr='title']").html())return alert("请填写第"+(s+1)+"-"+(n+1)+"的内容"),void $.pinput.handle.jumpOrder(s+1);if(1==u){if(0==c.find(".correct").length)return alert("请勾选第"+(s+1)+"-"+(n+1)+"的正确选项"),void $.pinput.handle.jumpOrder(s+1);console.log(c.find(".answer"));for(var p=0;p<c.find(".answer").length;p++)if(""==c.find(".answer")[p].innerHTML)return alert("请填写第"+(s+1)+"-"+(n+1)+"的"+t.ans[p]+"选项"),void $.pinput.handle.jumpOrder(s+1)}}}}e.path("/paper/preview/"+t.pid)},e.path().indexOf("paper/edit/")==-1&&(i.get(api_url+"/test/paper/preview?pid="+t.pid).success(function(e){e.paper.word&&($("#redactor_modal_overlay").css("display","block"),$.ajax({type:"GET",url:"http://218.244.140.132/"+e.paper.word,success:function(e){$(".mtk-import-info").css("display","none"),$(".mtk-contenter").css("display","none");var t=UM.getEditor("self-editor");t.ready(function(){$("#redactor_modal_overlay").css("display","none"),t.setContent(e)})}}))}),window.uploader=new plupload.Uploader({browse_button:"pickfiles",file_data_name:"file",url:"http://218.244.140.132:9000/doc2Html",filters:{mime_types:[{title:"word file",extensions:"doc,docx"}],prevent_duplicates:!0},multipart:!0}),uploader.init(),uploader.bind("FilesAdded",function(e,t){e.start(),$("#redactor_modal_overlay").css("display","block")}),uploader.bind("UploadProgress",function(e,t){$(".loading-info").html(t.percent+"%")}),uploader.bind("FileUploaded",function(e,s,a){$(".loading-info").html("waiting");var r=JSON.parse(a.response);if(s.name.indexOf(".docx")!=-1)var n="docx";else var n="doc";r.is_exist==-1?$.ajax({type:"POST",url:"http://218.244.140.132:9000/doc2Html/conver/"+r.md5+"/"+n,success:function(e){$(".mtk-import-info").css("display","none"),$(".mtk-contenter").css("display","none"),$.ajax({type:"GET",url:"http://218.244.140.132/"+r.path,success:function(e){$(".mtk-import-info").css("display","none"),$(".mtk-contenter").css("display","none");var s=UM.getEditor("self-editor");s.ready(function(){$("#redactor_modal_overlay").css("display","none"),s.setContent(e),i.put(api_url+"/test/paper",{pid:parseInt(t.pid),word:r.path}).success(function(e){})})}})}}):$.ajax({type:"GET",url:"http://218.244.140.132/"+r.path,success:function(e){$(".mtk-import-info").css("display","none"),$(".mtk-contenter").css("display","none");var s=UM.getEditor("self-editor");s.ready(function(){$("#redactor_modal_overlay").css("display","none"),s.setContent(e),i.put(api_url+"/test/paper",{pid:parseInt(t.pid),word:r.path}).success(function(e){})})}})}))}}}]),myService.directive("correctFooter",[function(){return{restict:"AE",replace:!0,templateUrl:"./views/work/correctFooter.html",controller:"workcorrect",link:function(){}}}]),myService.directive("myTab",["$rootScope","mxxServices","$location",function(e,t,i){return{restrict:"AE",replace:!0,templateUrl:"./views/directive/aside.html",link:function(t,i,s){e.location.indexOf("/index")!=-1&&$(".sidebar li .index").addClass("selected"),e.location.indexOf("/class/")!=-1&&$(".sidebar li .manger-class").addClass("selected"),e.location.indexOf("/paper/")!=-1&&$(".sidebar li .manger-paper").addClass("selected"),e.location.indexOf("/work/")!=-1&&$(".sidebar li .set-test").addClass("selected"),e.location.indexOf("/setting")!=-1&&$(".sidebar li .set-system").addClass("selected")}}}]),myService.directive("pagination",["mxxServices","$http",function(e,t){return{restrict:"AE",replace:!0,templateUrl:"./views/directive/pagination.html",link:function(e,t,i){e.next=function(){e.currentPage<e.num&&(e.currentPage++,e.getData())},e.prev=function(){e.currentPage>1&&(e.currentPage--,e.getData())},e.getData()}}}]),myService.factory("correctService",["$http",function(e){var t={getWorkBaseInfo:function(t){var i=api_url+"/correct/base?workId="+t,s=e.get(i).then(function(e){return e.data});return s},getCorrectInfoByqid:function(t,i){var s=api_url+"/correct/base/student?workId="+t+"&qid="+i,a=e.get(s).then(function(e){return e.data.studentList=e.data.studentList.concat(e.data.studentList2),e.data});return a},getStudentQidInfo:function(t,i,s){var a=api_url+"/answer?studentId="+s+"&workId="+t+"&qid="+i,r=e.get(a).then(function(e){return e.data});return r},submit:function(t){var i=api_url+"/answer/correct/crosshead",s=e.put(i,t).then(function(e){return e.data});return s},changeWorkStatus:function(t,i){var s=api_url+"/work/correct/finish",a=e.put(s,{workId:t,sendAll:i}).then(function(e){return e.data});return a},preview:function(t){var i=api_url+"/test/paper/preview?pid="+t,s=e.get(i).then(function(e){return e.data});return s},findObjInArray:function(e,t,i){for(var s=0;s<e.length;s++)if(e[s][t]==parseInt(i))return e[s]}};return t}]);
//# sourceMappingURL=app.min.js.map
