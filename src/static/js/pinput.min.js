!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports?module.exports=t:t(jQuery)}(function(t){t.pinput=t.pinput||{version:"0.0.1",ip_config:"http://115.29.177.200",api_url:{common:"/mstudy/question",composite:"/mstudy/stem",sub:"/mstudy/question/item",sort:"/mstudy/paper",save:"/mstudy/question",delCommon:"/mstudy/question/",delComposite:"/mstudy/stem/",delSub:"/mstudy/question/item/",version:"/mstudy/teacher2question/version/"},ui:{common:'<dt data-type="1"><div class="pinput-item-slide"><div class="pinput-item pinput-item-tit"><span class="tit">1.</span><span class="info">选择题</span></div><div class="pinput-item pinput-item-opt"><a class="del" href="javascript:;"></a><a class="show" href="javascript:;"></a></div></div><div class="pinput-item-main"><div class="pinput-item-content"><ul class="pinput-item-ver"></ul><div class="pinput-item-boder"><div class="pinput-problem"><div class="pinput-problem-info clearfix"><div class="pinput-problem-ico fl"></div><div class="score fr"><input maxlength="4" attr="score" value="0"></div></div><div class="title" contenteditable="true" attr="title"></div></div><div class="pinput-answer"><ul class="common-ul"><li class="answer-li clearfix"><div class="choice fl"></div><div class="letter fl">A.</div><div class="answer fl"  contenteditable="true" attr="answer"></div><a class="del" href="javascript:;"></a></li></ul><div class="add-answer"><span class="txt1">+</span><span class="txt2">新增一条选项</span></div></div></div><div class="pinput-item-analysis"><div class="tit">本题解析</div><div class="analysis"><ul class="analysis-ul"><li class="analysis-li clearfix"><div class="analysis-li1"><input type="text" maxlength="10" attr="analysis" value="本题解析"></div><div class="analysis-li2">/</div><div class="analysis-li3" contenteditable="true" attr="analysis"></div><a href="javascript:;" class="del"></a></li></ul><div class="add-analysis"><span class="txt1">+</span><span class="txt2">新增一条解析</span></div></div></div></div></div></dt>',"short":'<dt data-type="2"><div class="pinput-item-slide"><div class="pinput-item pinput-item-tit"><span class="tit">2.</span><span class="info">主观题</span></div><div class="pinput-item pinput-item-opt"><a class="del" href="javascript:;"></a><a class="show" href="javascript:;"></a></div></div><div class="pinput-item-main"><div class="pinput-item-content"><ul class="pinput-item-ver"></ul><div class="pinput-item-boder"><div class="pinput-problem"><div class="pinput-problem-info clearfix"><div class="pinput-problem-ico fl"></div><div class="score fr"><input readonly></div></div><div class="title" contenteditable="true" attr="title"></div></div><div class="pinput-answer"><ul class="short-ul"></ul><div class="add-options"><li class="add-img bd" title="新增图片框"><div class="add-text1"><span class="add-text1-sign">+</span>图片框</div><div class="add-text2">(拍照答题)</div></li><li class="add-vedio bd" title="新增录音框"><div class="add-text1"><span class="add-text1-sign">+</span>录音框</div><div class="add-text2">(录音答题)</div></li><li class="add-text bd" title="新增文本框"><div class="add-text1"><span class="add-text1-sign">+</span>文本框</div><div class="add-text2">(输入答题)</div></li><li class="add-position" title="新增填空项"><div class="add-text1"><span class="add-text1-sign">+</span>填空项</div><div class="add-text2">(填空答题)</div></li></div></div></div><div class="pinput-item-analysis"><div class="tit">本题解析</div><div class="analysis"><ul class="analysis-ul"><li class="analysis-li clearfix"><div class="analysis-li1"><input type="text" maxlength="10" attr="analysis" value="本题解析"></div><div class="analysis-li2">/</div><div class="analysis-li3" contenteditable="true" attr="analysis"></div><a href="javascript:;" class="del"></a></li></ul><div class="add-analysis"><span class="txt1">+</span><span class="txt2">新增一条解析</span></div></div></div></div></div></dt>',composite:'<dt data-type="3"><div class="pinput-item-slide"><div class="pinput-item pinput-item-tit"><span class="tit">3.</span><span class="info">复合题</span></div><div class="pinput-item pinput-item-opt"><a class="del" href="javascript:;"></a><a class="show" href="javascript:;"></a></div></div><div class="pinput-item-main"><div class="pinput-item-content"><ul class="pinput-item-ver"></ul><div class="pinput-item-subject clearfix"><div class="fl add-media"><a class="vedio" href="javascript:;">视频</a><a class="mp3"  href="javascript:;">音频</a></div><div class="fl edit-div subject" attr="material" contenteditable="true"></div></div><div class="pinput-item-question"></div><div class="add-question"><div class="add-simple choice">选择题</div><div class="add-simple nochoice">非选择题</div></div></div></div></dt>',subCommon:'<div class="pinput-question"><div class="pinput-item-boder"><div class="pinput-problem"><div class="pinput-problem-info clearfix"><div class="pinput-problem-ico fl"></div><div class="fl tit">3-1.</div> <a href="javascript:;" class="del"></a><div class="score fr"><input maxlength="4" attr="score" value="0"></div></div><div class="title" contenteditable="true" attr="title"></div></div><div class="pinput-answer"><ul class="common-ul"><li class="answer-li clearfix"><div class="choice fl"></div><div class="letter fl">A.</div><div class="answer fl" contenteditable="true" attr="answer"></div><a class="del" href="javascript:;"></a></li></ul><div class="add-answer"><span class="txt1">+</span> <span class="txt2">新增一条选项</span></div></div></div><div class="pinput-item-analysis"><div class="tit">本题解析</div><div class="analysis"><ul class="analysis-ul"><li class="analysis-li clearfix"><div class="analysis-li1"><input type="text" maxlength="10" attr="analysis" value="本题解析"></div><div class="analysis-li2">/</div><div class="analysis-li3" contenteditable="true" attr="analysis"></div><a href="javascript:;" class="del"></a></li></ul><div class="add-analysis"><span class="txt1">+</span><span class="txt2">新增一条解析</span></div></div></div></div>',subShort:'<div class="pinput-question"><div class="pinput-item-boder"><div class="pinput-problem"><div class="pinput-problem-info clearfix"><div class="pinput-problem-ico fl"></div><div class="fl tit">3-2.</div><a href="javascript:;" class="del"></a><div class="score fr"><input maxlength="4" readonly></div></div><div class="title" contenteditable="true" attr="title"></div></div><div class="pinput-answer"><ul class="short-ul"></ul><div class="add-options"><li class="add-img bd" title="新增图片框"><div class="add-text1"><span class="add-text1-sign">+</span>图片框</div><div class="add-text2">(拍照答题)</div></li><li class="add-vedio bd" title="新增录音框"><div class="add-text1"><span class="add-text1-sign">+</span>录音框</div><div class="add-text2">(录音答题)</div></li><li class="add-text bd" title="新增文本框"><div class="add-text1"><span class="add-text1-sign">+</span>文本框</div><div class="add-text2">(输入答题)</div></li><li class="add-position" title="新增填空项"><div class="add-text1"><span class="add-text1-sign">+</span>填空项</div><div class="add-text2">(填空答题)</div></li></div></div></div><div class="pinput-item-analysis"><div class="tit">本题解析</div><div class="analysis"><ul class="analysis-ul"><li class="analysis-li clearfix"><div class="analysis-li1"><input type="text" maxlength="10" attr="analysis" value="本题解析"></div><div class="analysis-li2">/</div><div class="analysis-li3" contenteditable="true" attr="analysis"></div><a href="javascript:;" class="del"></a></li></ul><div class="add-analysis"><span class="txt1">+</span><span class="txt2">新增一条解析</span></div></div></div></div>',main:'<div class="add-btn clearfix"><div class="add-new-common">新增选择题</div><div class="add-new-short">新增主观题</div><div class="add-new-composite">新增复合题</div></div>',reply:'<li class="answer-li answer-subject"><div class="letter">1.</div><div class="reply">[图片答题框]</div><div class="score"><input maxlength="4" attr="sscore"></div><a href="javascript:;" class="del"></a></li>',choice:'<li class="answer-li clearfix"><div class="choice fl"></div><div class="letter fl">A.</div><div class="answer fl" contenteditable="true" attr="answer"></div><a class="del" href="javascript:;"></a></li>',analysis:'<li class="analysis-li clearfix"><div class="analysis-li1"><input type="text" maxlength="10" attr="analysis"></div><div class="analysis-li2">/</div><div class="analysis-li3" contenteditable="true" attr="analysis"></div><a href="javascript:;" class="del"></a></li>',vedio:'<div class="confirm-media add-vedio-input"><a href="javascript:;" class="close-media">X</a><p><input value="" placeholder="请输入视频播放地址"><button type="button" media="vedio">确定</button></p><p class="remind">目前已支持<i>优酷网</i>&nbsp;<i>土豆网</i>&nbsp;<i>腾讯网</i>等视频网站的视频播放页通用代码</p><p class="warn" style="display: none;">提示:暂不支持该链接,请使用通用代码(复制第三方视频网页分享的通用代码)。</p></div>',mp3:'<div class="confirm-media add-mp3-input"><a href="javascript:;" class="close-media">X</a><input value="" placeholder="请输入音频播放地址"><button type="button" media="mp3">确定</button><p class="warn" style="color: rgb(152, 152, 152);">提示:&nbsp;目前只支持mp3格式&nbsp;（例：http://······/name.mp3）。</p></div>'}},t.fn.pinput=function(i){t.extend(!0,t.pinput,i),t.pinput.handle.init(this)};for(var i=document.cookie.split(";"),n=0;n<i.length;n++)if(-1!=i[n].indexOf("user"))var a=i[n].split("="),s=JSON.parse(decodeURIComponent(a[1])),p=s.tid,d="?token="+s.token;t.get(t.pinput.ip_config+"/mstudy/teacher/"+p+d).success(function(i){var n=i.con.permission;0==n&&(t(".add-new-short").addClass("permission"),t(".pinput").on("mouseover",".add-simple.nochoice",function(){t(this).text("没有权限")}),t(".pinput").on("mouseout",".add-simple.nochoice",function(){t(this).text("非选择题")}))});var l=window.location.hash.split("/"),r=l[l.length-1],o={tid:p,pid:parseInt(r),drop:!1,btn:!0,vData:{},subject:{}};t.pinput.handle={settings:{type:"get",dataType:"json",error:function(){}},init:function(i){t.pinput.plugin.init(i),o.dl=t(".pinput-dl"),this.addCommon(),this.addShort(),this.addComposite(),this.addSubCommon(),this.addSubShort(),this.addShortReply(),this.addAnalysis(),this.addAanswer(),this.addMedia(),this.showHide(),this.sortQuestion(),this.delQuestion(),this.sortAnswer(),this.saveData(),this.saveCorrect(),this.dropSave(),this.jump(),this.version()},version:function(){function i(){var i=t(this),n=i.parents("dt"),a=n.attr("data-type"),s=!0;switch(parseInt(a)){case 1:case 2:var e=n.find(".pinput-item-ver"),p=n.attr("qid");break;case 3:var l=i.parents(".pinput-question"),a=l.attr("data-type"),e=l.find(".pinput-item-ver"),r=n.find(".pinput-item-subject").prev(),c=n.attr("qsid"),p=l.attr("qid")}if(e.find(".ver-li").size()&&(s=!1,e.toggle()),s){var u=t.pinput.ip_config+t.pinput.api_url.version+o.tid+"/"+parseInt(p)+d,v=t.pinput.plugin.extend({type:"get",url:u,success:function(i){if(1==i.ret){var i=i.con,n="";if(i.count>0){for(var s=0;s<i.versions.length;s++){var l="";i.questions[s].qid==p&&(l="current");var u=t.pinput.plugin.getLocalTime(1e3*i.versions[s]),v=i.questions[s].qid;n+='<li class="ver-li clearfix '+l+' " qid="'+v+'" type="'+a+'"><div class="ver-control fl"></div><div class="ver-date fl">'+u+'</div> <a class="del" href="javascript:;"></a></li>',o.vData[v]=i.questions[s]}e.append(n).show()}}if("undefined"!=typeof c){var f=t.pinput.ip_config+t.pinput.api_url.version+o.tid+"/"+parseInt(c)+d+"&action=2",m=t.pinput.plugin.extend({type:"get",url:f,success:function(i){if(console.log(i),1==i.ret){var i=i.con,n="";if(i.count>0){for(var a=0;a<i.versions.length;a++){var s="";i.questions[a].qsid==c&&(s="current");var e=t.pinput.plugin.getLocalTime(1e3*i.versions[a]),p=i.questions[a].qsid;n+='<li class="ver-li clearfix '+s+' " qsid="'+p+'" type="3"><div class="ver-control fl"></div><div class="ver-date fl">'+e+'</div> <a class="del" href="javascript:;"></a></li>',o.subject[p]=i.questions[a]}r.append(n).show()}}}});t.ajax(m)}}});t.ajax(v)}}t(".pinput").on("click",".ver-li",function(){var i=t(this),n=i.attr("type"),a=i.parent().parent();if(!i.hasClass("current")){if(1==n||2==n){var s=i.attr("qid"),e=o.vData[s];if(a.hasClass("pinput-question")){var p=a.attr("qid");a.attr("qid",s)}else{var p=i.parents("dt").attr("qid");i.parents("dt").attr("qid",s)}}else if(3==n){var l=i.attr("qsid"),e=o.subject[l];e.qtype=3;var p=a.attr("qsid");i.parents("dt").attr("qsid",l)}switch(a.find(".title").html(e.content),a.find(".score input").val(e.score),parseInt(e.qtype)){case 1:var r=a.find(".common-ul"),c=["A","B","C","D","E","F","G","H","I","J"];if(e.choices instanceof Array){r.empty();for(var u=0;u<e.choices.length;u++){var v=t(t.pinput.ui.choice).find(".letter").text(c[u]+".").end().find(".answer").html(e.choices[u]).end();e.answer instanceof Array&&t.pinput.plugin.in_array(u,e.answer)&&v.find(".choice").addClass("correct").end(),r.append(v)}}break;case 2:var f=a.find(".short-ul");if(e.choices[0]&&e.choices[0]instanceof Array){f.empty();for(var u=0;u<e.choices[0].length;u++){var m="",h="",v="";switch(e.choices[0][u]){case 1:m="[填空答题框]";break;case 2:m="[文本答题框]";break;case 3:m="[图片答题框]";break;case 4:m="[音频答题框]"}e.choices[1]&&e.choices[1][u]&&(h=e.choices[1][u]),v=t(t.pinput.ui.reply).attr("type",e.choices[0][u]).find(".letter").text(u+1+".").end().find(".reply").text(m).end().find(".score input").val(h).end(),f.append(v)}}case 3:a.find(".subject").html(e.content)}if(e.resolve){var g=a.find(".analysis-ul");g.empty(),t.each(e.resolve,function(i,n){var a=t(t.pinput.ui.analysis).find(".analysis-li1 input").val(i).end().find(".analysis-li3").html(n).end();g.append(a)})}var y=t.pinput.ip_config+t.pinput.api_url.sort+d,x=new Array,b=o.dl.find("dt");t.each(b,function(){var i=t(this),n=i.find(".pinput-question");struct={qid:parseInt(i.attr("qid")),isComposite:2==i.attr("qid")?1:-1,stem:t.pinput.plugin.getids(n)},x.push(struct)});var q=t.pinput.plugin.extend({type:"patch",contentType:"application/json",url:y,data:JSON.stringify({pid:parseInt(o.pid),struct:x}),success:function(t){console.log(t),1==t.ret?i.addClass("current").siblings().removeClass("current"):1==n||2==n?a.hasClass("pinput-question")?a.attr("qid",p):i.parents("dt").attr("qid",p):3==n&&i.parents("dt").attr("qsid",p)},error:function(){1==n||2==n?a.hasClass("pinput-question")?a.attr("qid",p):i.parents("dt").attr("qid",p):3==n&&i.parents("dt").attr("qsid",p)}});t.ajax(q)}}),t(".pinput").on("click",".pinput-problem-ico",i)},addMedia:function(){t(".pinput").on("click",".add-media .vedio,.add-media .mp3",function(i){t(".confirm-media").remove();var n=t(this),a=n.offset(),s=n.attr("class");t(t.pinput.ui[s]).data("subject",n.parents(".pinput-item-subject").find(".subject")).css({top:a.top+50,left:a.left+50}).appendTo(".pinput"),i.stopPropagation()}),t(".pinput").on("click",".close-media",function(){t(".confirm-media").remove()}),t(document).click(function(i){var n=(t(this),t(i.target)),a=n.parents(".confirm-media").size();n.hasClass("confirm-media")||a||t(".confirm-media").remove()}),t(".pinput").on("click",".confirm-media button",function(){var i=t(this),n=i.parents(".confirm-media").data("subject"),a=i.attr("media"),s=i.prev().val();"vedio"==a&&(s=t(i.prev().val()).attr("src"));var e=t('<img class="media-img" src="./static/images/'+a+'.png" _src="'+s+'" type="'+a+'" />');n.append(e),t(".confirm-media").remove(),t.pinput.handle.save_material.call(n)})},addCommon:function(){t(".pinput").on("click",".add-new-common",function(){var i=t.pinput.ip_config+t.pinput.api_url.common+d,n=t.pinput.plugin.extendScore(o.dl,1),a=t.pinput.plugin.extend({type:"put",contentType:"application/json",url:i,data:JSON.stringify({tid:o.tid,qtype:1,pid:o.pid,score:n}),success:function(i){if(1==i.ret){var i=i.con,a=t.pinput.plugin.getnum(),s=t(t.pinput.ui.common).attr("qid",i.qid).find(".pinput-item-tit .tit").text(a+".").end().find(".score input").val(n).end();o.dl.append(s),t.pinput.plugin.addAnimate(),t.pinput.plugin.addOrder(a,n)}}});t.ajax(a)})},addShort:function(){t(".add-new-short").hover(function(i){t(".add-new-short").hasClass("permission")&&t(".add-new-short").text("没有权限")},function(){t(".add-new-short").text("新增主观题")}),t(".pinput").on("click",".add-new-short",function(){t(".add-new-short").hasClass("permission")||t.get(t.pinput.ip_config+"/mstudy/teacher/"+p+d).success(function(i){var n=t.pinput.ip_config+t.pinput.api_url.common+d,a=t.pinput.plugin.extend({type:"put",contentType:"application/json",url:n,data:JSON.stringify({tid:o.tid,qtype:2,pid:o.pid}),success:function(i){if(1==i.ret){var i=i.con,n=t.pinput.plugin.getnum(),a=t(t.pinput.ui["short"]).attr("qid",i.qid).find(".pinput-item-tit .tit").text(n+".").end();o.dl.append(a),t.pinput.plugin.addAnimate(),t.pinput.plugin.addOrder(n,0)}}});t.ajax(a)})})},addComposite:function(){t(".pinput").on("click",".add-new-composite",function(){var i=t.pinput.ip_config+t.pinput.api_url.composite+d,n=t.pinput.plugin.extend({type:"put",contentType:"application/json",url:i,data:JSON.stringify({tid:o.tid,pid:o.pid}),success:function(i){if(1==i.ret){var i=i.con,n=t.pinput.plugin.getnum(),a=a=t(t.pinput.ui.composite).attr("qsid",i.qsid).find(".pinput-item-tit .tit").text(n+".").end();o.dl.append(a),t.pinput.plugin.addAnimate()}}});t.ajax(n)})},addSubCommon:function(){t(".pinput").on("click",".add-simple.choice",function(){var i=t(this),n=parseInt(i.parents("dt").find(".pinput-item-tit .tit").text()),a=i.parents("dt"),s=a.find(".pinput-question").size(),e=n+"-"+(s+1),p=t.pinput.plugin.extendScore(a,3),l=t(t.pinput.ui.subCommon).find(".pinput-problem-info .tit").text(e+".").end().find(".score input").val(p).end(),r=t.pinput.ip_config+t.pinput.api_url.sub+d,c={tid:o.tid,pid:o.pid,qtype:1,qsid:parseInt(a.attr("qsid")),score:p};settings=t.pinput.plugin.extend({type:"put",contentType:"application/json",url:r,data:JSON.stringify(c),success:function(i){1==i.ret&&(a.find(".pinput-item-question").append(l.attr({qid:i.con.qid,"data-type":1})),t.pinput.plugin.addAnimate(a),t.pinput.plugin.addOrder(e,p))}}),t.ajax(settings)})},addSubShort:function(){t(".pinput").on("click",".add-simple.nochoice",function(){if(t(".add-new-short").hasClass("permission"))return void console.log(1111);var i=t(this),n=parseInt(i.parents("dt").find(".pinput-item-tit .tit").text()),a=i.parents("dt"),s=a.find(".pinput-question").size(),e=n+"-"+(s+1),p=t(t.pinput.ui.subShort).find(".pinput-problem-info .tit").text(e+".").end(),l=t.pinput.ip_config+t.pinput.api_url.sub+d,r={tid:o.tid,pid:o.pid,qtype:2,qsid:parseInt(a.attr("qsid"))},c=t.pinput.plugin.extend({type:"put",contentType:"application/json",url:l,data:JSON.stringify(r),success:function(i){1==i.ret&&(a.find(".pinput-item-question").append(p.attr({qid:i.con.qid,"data-type":2})),t.pinput.plugin.addAnimate(a),t.pinput.plugin.addOrder(e,0))}});t.ajax(c)})},addShortReply:function(){t(".pinput").on("click",".add-options li",function(){var i=t(this),n=["img","vedio","text","position"],a={img:"图片",vedio:"音频",text:"文本",position:"填空"},s={img:3,vedio:4,text:2,position:1},e=i.attr("class");for(var p in n)if(-1!=e.indexOf(n[p])){var l=i.parents(".pinput-answer").find("ul li").size()+1,r=t(t.pinput.ui.reply).attr("type",s[n[p]]).find(".letter").text(l+".").end().find(".reply").text("["+a[n[p]]+"答题框]").end();i.parents(".pinput-answer").find("ul").append(r);break}var o=t.pinput.plugin.formatReply(i),c=t.pinput.ip_config+t.pinput.api_url.save+d,u=t.pinput.plugin.extend({type:"patch",contentType:"application/json",url:c,data:JSON.stringify(o),success:function(t){console.log(t),1==t.ret?console.log("成功"):r.remove()},error:function(){r.remove()}});console.log(o),t.ajax(u)})},addAnalysis:function(){t(".pinput").on("click",".add-analysis",function(){t(this).parent().find(".analysis-ul").append(t.pinput.ui.analysis)})},addAanswer:function(){t(".pinput").on("click",".add-answer",function(){var i=["A","B","C","D","E","F","G","H","I","J"],n=t(this).parent().find("ul"),a=n.find("li").size();i[a]&&n.append(t(t.pinput.ui.choice).find(".letter").text(i[a]+".").end())})},sortQuestion:function(){o.dl.on("mousemove",".show",function(){t.pinput.handle.sortQuestionInit(),t(this).parents("dt").hasClass("sort")?o.dl.sortable("enable"):o.dl.sortable("disable")}),o.dl.on("mousedown",function(i){o.dl.sortable(),t(i.target).hasClass("show")||o.dl.sortable("disable")})},sortQuestionInit:function(){o.dl.sortable({axis:"y",revert:!1,start:function(){},update:function(){var i=t.pinput.ip_config+t.pinput.api_url.sort+d,n=new Array,a=o.dl.find("dt");t.each(a,function(){var i=t(this),a=i.find(".pinput-question");struct={qid:parseInt(i.attr("qid")),isComposite:2==i.attr("qid")?1:-1,stem:t.pinput.plugin.getids(a)},n.push(struct)});var s=t.pinput.plugin.extend({type:"patch",contentType:"application/json",url:i,data:JSON.stringify({pid:o.pid,struct:n}),success:function(i){console.log(i),1==i.ret?(t.pinput.plugin.initNum(),t.pinput.plugin.order()):o.dl.sortable("cancel")},error:function(){o.dl.sortable("cancel")}});t.ajax(s)}})},sortAnswer:function(){o.dl.on("mousemove",".short-ul",function(){t(".short-ul").sortable({axis:"y",revert:!1,start:function(){},update:function(i,n){var a=t(i.target),s=t.pinput.plugin.formatReply(a),e=t.pinput.ip_config+t.pinput.api_url.save+d,p=t.pinput.plugin.extend({type:"patch",contentType:"application/json",url:e,data:JSON.stringify(s),success:function(i){console.log(i),1==i.ret?t.pinput.plugin.shortNum.call(a):a.sortable("cancel")},error:function(){a.sortable("cancel")}});t.ajax(p)},stop:function(){}})}),o.dl.on("mousemove",".common-ul",function(){t(".common-ul").sortable({axis:"y",revert:!1,start:function(){},update:function(i,n){for(var a=t(i.target),s=0,e=t.pinput.plugin.formatChoice(a),p=t.pinput.ip_config+t.pinput.api_url.save+d,l=0;l<e.choices.length;l++)""==e.choices[l]?++s:"";if(s==e.choices.length)return void t.pinput.plugin.commonNum.call(a);var r=t.pinput.plugin.extend({type:"patch",contentType:"application/json",url:p,data:JSON.stringify(e),success:function(i){console.log(i),1==i.ret?t.pinput.plugin.commonNum.call(a):a.sortable("cancel")},error:function(){a.sortable("cancel")}});t.ajax(r)},stop:function(){}})}),o.dl.on("mousedown",".short-ul,.common-ul",function(t){})},showHide:function(){t(".pinput").on("click",".pinput-item-slide",function(){var i=t(this).parents("dt");i.toggleClass("sort"),i.find(".pinput-item-slide").toggleClass("pinput-item-slide-a"),i.find(".pinput-item-main").toggle(),i.find(".pinput-item-opt .del").toggle()})},saveData:function(){var i=this;t(".pinput").on("click",'div[contenteditable="true"]',function(){"INPUT"!=this.tagName&&t(this).trigger("focus")}),t(".pinput").on("focus",'div[contenteditable="true"],input',function(){var i=t(this),n=this.tagName,a="INPUT"==n?i.val():i.html();i.parents(".ui-sortable").sortable(),"score"==i.attr("attr")?i.data("data",Number(a)):i.data("data",t.pinput.plugin.trim(a)),i.parents(".ui-sortable").sortable("disable")}),t(".pinput").on("blur",'div[contenteditable="true"],input',function(){var n=t(this),a=n.attr("attr");switch(n.parents(".ui-sortable").sortable("enable"),a){case"sscore":case"score":var s=Number(n.val());if(!/^[\d\.]+$/.test(s))return void n.val("");break;default:var e="INPUT"==this.tagName?n.val():n.html(),s=t.pinput.plugin.trim(e);if(""==s)return}if(o.drop||s!=n.data("data")){o.drop=!1;var p="save_"+a;"function"==typeof i[p]&&i[p].call(n)}})},save_sscore:function(){var i=this,n=t.pinput.plugin.formatReply(i),a=t.pinput.ip_config+t.pinput.api_url.save+d,s=t.pinput.plugin.extend({type:"patch",contentType:"application/json",url:a,data:JSON.stringify(n),success:function(a){if(console.log(a),1==a.ret){console.log("成功"),i.parents(".pinput-item-boder").find(".pinput-problem .score input").val(n.score.toFixed(2));var s=i.parents("dt"),e=s.attr("data-type");switch(parseInt(e)){case 2:var p=parseInt(s.find(".pinput-item-slide .tit").text());break;case 3:var p=i.parents(".pinput-question").find(".pinput-problem .tit").text(),p=p.substring(0,p.length-1)}t.pinput.plugin.setScore(p,n.score)}}});t.ajax(s)},save_score:function(){var i=this,n=i.parents("dt"),a=n.attr("data-type");switch(parseInt(a)){case 1:var s=n.attr("qid"),e=parseInt(n.find(".pinput-item-slide .tit").text());break;case 3:var p=n.attr("qsid"),s=i.parents(".pinput-question").attr("qid"),e=i.parents(".pinput-question").find(".pinput-problem .tit").text(),e=e.substring(0,e.length-1)}var l={pid:o.pid,qid:parseInt(s),qsid:"undefined"==typeof p?"":parseInt(p),score:Number(i.val())},r=t.pinput.ip_config+t.pinput.api_url.save+d,c=t.pinput.plugin.extend({type:"patch",contentType:"application/json",url:r,data:JSON.stringify(l),success:function(n){console.log(n),1==n.ret&&(console.log("成功"),i.addClass("save"),t.pinput.plugin.setScore(e,l.score))}});t.ajax(c)},save_title:function(){var i=this,n=i.parents("dt"),a=n.attr("data-type");switch(parseInt(a)){case 1:case 2:var s=n.attr("qid");break;case 3:var e=n.attr("qsid"),s=i.parents(".pinput-question").attr("qid")}var p={pid:o.pid,qid:parseInt(s),qsid:"undefined"==typeof e?"":parseInt(e),content:i.html()},l=t.pinput.ip_config+t.pinput.api_url.save+d,r=t.pinput.plugin.extend({type:"patch",contentType:"application/json",url:l,data:JSON.stringify(p),success:function(t){1==t.ret&&(i.addClass("save"),console.log("成功"))}});console.log(p),t.ajax(r)},save_answer:function(){var i=this,n=i.parents("dt"),a=t.pinput.ip_config+t.pinput.api_url.save+d,s=n.attr("data-type"),e=new Array;switch(parseInt(s)){case 1:var p=n.find(".answer"),l=n.attr("qid");break;case 3:var r=n.attr("qsid"),l=i.parents(".pinput-question").attr("qid"),p=i.parents(".pinput-answer").find(".answer")}t.each(p,function(){e.push(t(this).html())});var c={pid:o.pid,qid:parseInt(l),qsid:"undefined"==typeof r?"":parseInt(r),choices:e},u=t.pinput.plugin.extend({type:"patch",contentType:"application/json",url:a,data:JSON.stringify(c),success:function(t){console.log(t),1==t.ret&&(i.parent().addClass("save"),console.log("成功"))}});t.ajax(u)},save_analysis:function(){var i=this,n=t.pinput.ip_config+t.pinput.api_url.save+d,a=t.pinput.plugin.formatAnalysis(i),s=t.pinput.plugin.extend({type:"patch",contentType:"application/json",url:n,data:JSON.stringify(a),success:function(t){console.log(t),1==t.ret&&("DIV"==i[0].tagName?i.parent().addClass("save"):"",console.log("成功"))}});t.ajax(s)},save_material:function(){var i=this,n=i.parents("dt"),a={pid:o.pid,qsid:parseInt(n.attr("qsid")),content:n.find(".subject").html()},s=t.pinput.ip_config+t.pinput.api_url.composite+d,e=t.pinput.plugin.extend({type:"patch",contentType:"application/json",url:s,data:JSON.stringify(a),success:function(t){console.log(t),1==t.ret&&(i.addClass("save"),console.log("成功"))}});t.ajax(e)},delQuestion:function(){t(".pinput").on("click",".short-ul .del",function(i){var n=t(this);n.parent().addClass("li-del");var a=t.pinput.plugin.formatReply(n),s=t.pinput.ip_config+t.pinput.api_url.save+d,e=t.pinput.plugin.extend({type:"patch",contentType:"application/json",url:s,data:JSON.stringify(a),success:function(i){if(console.log(i),1==i.ret){console.log("成功"),n.parents(".pinput-item-boder").find(".pinput-problem .score input").val(a.score);var s=n.parents(".short-ul");n.parent().remove(),t.pinput.plugin.shortNum.call(s)}else n.parent().removeClass("li-del")},error:function(){n.parent().removeClass("li-del")}});t.ajax(e)}),t(".pinput").on("click",".common-ul .del",function(i){var n=t(this),a=n.parents(".common-ul"),s=t.pinput.ip_config+t.pinput.api_url.save+d;if(1==n.parents(".common-ul").find("li").size())return void alert("至少有一个选项");n.parent().addClass("li-del");var e=t.pinput.plugin.formatChoice(n),p=t.pinput.plugin.extend({type:"patch",contentType:"application/json",url:s,data:JSON.stringify(e),success:function(i){console.log(i),1==i.ret?(n.parent().remove(),t.pinput.plugin.commonNum.call(a)):n.parent().removeClass("li-del")},error:function(){n.parent().removeClass("li-del")}});t.ajax(p)}),t(".pinput").on("click",".analysis-ul .del",function(i){var n=t(this),a=t.pinput.ip_config+t.pinput.api_url.save+d;n.parent().addClass("li-del");var s=t.pinput.plugin.formatAnalysis(n),e=t.pinput.plugin.extend({type:"patch",contentType:"application/json",url:a,data:JSON.stringify(s),success:function(t){console.log(t),1==t.ret?(console.log("成功"),n.parent().remove()):n.parent().removeClass("li-del")},error:function(){n.parent().removeClass("li-del")}});t.ajax(e)}),t(".pinput").on("click",".pinput-item-opt .del",function(i){var n=t(this),a=n.parents("dt"),s=a.attr("data-type");switch(parseInt(s)){case 1:case 2:var e=parseInt(a.attr("qid")),p=t.pinput.ip_config+t.pinput.api_url.delCommon+e+d+"&pid="+o.pid;break;case 3:var l=parseInt(a.attr("qsid")),p=t.pinput.ip_config+t.pinput.api_url.delComposite+l+d+"&pid="+o.pid}var r=t.pinput.plugin.extend({type:"delete",url:p,success:function(i){if(1==i.ret){var n=a.find(".pinput-item-tit .tit").text();n=n.substring(0,n.length-1),a.parent("div").length?a.parent("div").remove().end():a.remove().end(),t.pinput.plugin.initNum(),t.pinput.plugin.delOrder(n,s)}}});t.ajax(r),i.stopPropagation()}),t(".pinput").on("click",".pinput-problem-info .del",function(){var i=t(this),n=i.parents("dt"),a=i.parents(".pinput-question"),s={qid:parseInt(a.attr("qid")),qsid:parseInt(i.parents("dt").attr("qsid")),pid:o.pid},e=t.pinput.ip_config+t.pinput.api_url.delSub+s.qid+d+"&qsid="+s.qsid+"&pid="+o.pid,p=t.pinput.plugin.extend({type:"delete",url:e,success:function(i){if(1==i.ret){var s=a.find(".pinput-problem-info .tit").text();s=s.substring(0,s.length-1),a.remove(),t.pinput.plugin.initSubNum(n),t.pinput.plugin.delOrder(s,a.attr("data-type"))}}});t.ajax(p)})},saveCorrect:function(){o.dl.on("mouseover",".answer-li .choice",function(){t(this).parents("ul").sortable("disable")}),o.dl.on("mouseout",".answer-li .choice",function(){t(this).parents("ul").sortable("enable")}),t(".pinput").on("click",".answer-li .choice",function(){var i=t(this),n=i.parents("dt"),a=n.attr("data-type"),s=t.pinput.ip_config+t.pinput.api_url.save+d,e=t.pinput.plugin.trim(t.pinput.plugin.remove_space(i.parents("li").find(".answer").html()));if(""!=e){i.toggleClass("correct");var p=[],l=i.parents(".pinput-answer").find(".choice");switch(t.each(l,function(i){t(this).hasClass("correct")&&p.push(i)}),parseInt(a)){case 1:var r=n.attr("qid");break;case 3:var c=n.attr("qsid"),r=i.parents(".pinput-question").attr("qid")}var u={pid:o.pid,qid:parseInt(r),qsid:"undefined"==typeof c?"":parseInt(c),answer:p},v=t.pinput.plugin.extend({type:"patch",contentType:"application/json",url:s,data:JSON.stringify(u),success:function(t){console.log(t),1==t.ret?console.log("成功"):i.toggleClass("correct")},error:function(){i.toggleClass("correct")}});t.ajax(v)}})},dropSave:function(){o.dl.on("drop",'div[contenteditable="true"],input',function(){o.drop=!0,"INPUT"==this.tagName?t(this).trigger("focus","drop"):t(this).trigger("click","drop")})},jump:function(){t(".t-stat-score-detail").on("click",".t-stat-li",function(){var i=t(this).attr("tit");t.pinput.handle.jumpOrder(i)}),t(".t-stat-score-detail h2").on("click",function(){"全部收起"==t(this).text().trim()?(t(".pinput").find(".pinput-item-slide").addClass("pinput-item-slide-a"),t(".pinput dt").addClass("sort"),t(".pinput").find(".pinput-item-main").css("display","none"),t(".pinput").find(".pinput-item-opt .del").css("display","none"),t(this).text("全部展开")):(t(".pinput").find(".pinput-item-slide").removeClass("pinput-item-slide-a"),t(".pinput dt").removeClass("sort"),t(".pinput").find(".pinput-item-main").css("display","block"),t(".pinput").find(".pinput-item-opt .del").css("display","block"),t(this).text("全部收起"))}),t(".toggle-stat").click(function(){var i=t(this);i.hasClass("t-toggle")?(t(".t-box").show(),t(".t-box").stop(!0,!0).animate({width:116},300,function(){t(".t-box").animate({height:499},function(){i.removeClass("t-toggle")})})):(i.addClass("t-toggle"),t(".t-box").stop(!0,!0).animate({height:30},300,function(){t(".t-box").animate({width:0,height:0},function(){t(".t-box").hide()})}))})},jumpOrder:function(i){var i=i+"";if(-1!==i.indexOf("-"))var n=i.split("-"),a=t(".pinput").find("dt").eq(n[0]-1),s=a.find(".pinput-question").eq(n[1]-1);else var s=t(".pinput").find("dt").eq(i-1);t("body,html").animate({scrollTop:s.offset().top},1e3)}},t.pinput.plugin={init:function(i){i.addClass("pinput").append(t.pinput.ui.main);
},setScore:function(i,n){t(".t-stat-score-detail li[tit="+i+"]").find("i").text(n.toFixed(2)),t.pinput.plugin.sumScore()},sumScore:function(){var i=0;t.each(t(".t-stat-li"),function(){i+=Number(t(this).find("i").text())}),t(".t-stat-score-total p").text(i.toFixed(2))},addOrder:function(i,n){var i=i+"",a='<li class="t-stat-li" tit="'+i+'"><span class="t-stat-tit fl">'+i+'.</span><span class="t-stat-score fl"><i>'+n.toFixed(2)+"</i>分</span></li>";if(-1!=i.indexOf("-"))var s=i.split("-"),e=parseInt(s[0])+1;var p=t("li[tit^="+e+"]");p.size()?p.before(a):t(".t-stat-score-detail ul").append(a)},delOrder:function(i,n){var i=i+"";if(-1==i.indexOf("-"))if(3==n){i+="-";var a=t(".t-stat-score-detail .scroll").find("li[tit^="+i+"]");t.each(a,function(){var i=t(this);i.remove()})}else t(".t-stat-score-detail").find("li[tit="+i+"]").remove();else t(".t-stat-score-detail").find("li[tit="+i+"]").remove();t.pinput.plugin.order(),t.pinput.plugin.sumScore()},order:function(){var i=t(".t-stat-score-detail .t-stat-li"),n=0;t.each(t(".pinput dt .pinput-item-slide .tit"),function(){var a=t(this),s=a.parents("dt"),e=s.attr("data-type"),p=parseInt(a.text());switch(parseInt(e)){case 3:t.each(s.find(".pinput-question"),function(){var a=t(this).find(".pinput-problem .tit").text()+"",s=a.substr(0,a.length-1),e=t(this).find(".score input").val();i.eq(n).attr("tit",s).find(".t-stat-tit").text(a),e||(e=0),i.eq(n).find(".t-stat-score i").text(e),n++});break;default:var d=s.find(".score input").val();i.eq(n).attr("tit",p).find(".t-stat-tit").text(p+"."),d||(d=0),i.eq(n).find(".t-stat-score i").text(d),n++}})},getnum:function(){return parseInt(t(".pinput dt").size())+1},initNum:function(){var i=1;t.each(t(".pinput dt"),function(){t(this).find(".pinput-item-tit .tit").text(i++ +".");var n=1,a=t(this).find(".pinput-question");t.each(a,function(){t(this).find(".pinput-problem-info .tit").text(i-1+"-"+n++ +".")})})},initSubNum:function(i){var n=i.find(".pinput-question"),a=i.find(".pinput-item-tit .tit").text();a=a.substring(0,a.length-1),t.each(n,function(i){t(this).find(".pinput-problem-info .tit").text(a+"-"+(i+1)+".")})},shortNum:function(){var i=this.find("li"),n=1;t.each(i,function(){t(this).find(".letter").text(n++ +".")})},commonNum:function(){var i=this.find("li"),n=["A","B","C","D","E","F","G","H","I","J"];t.each(i,function(i){t(this).find(".letter").text(n[i]+".")})},trim:function(t){return t?t.replace(/(^\s*)|(\s*$)/g,""):t},remove_space:function(t){return t.replace(/&nbsp;/g,"")},extend:function(i){return t.extend(!0,{},t.pinput.handle.settings,i)},getids:function(i){var n=[];return i.size()&&i.each(function(){n.push(t(this).attr("qid"))}),n},addAnimate:function(i){var n=arguments[0]?i.find(".pinput-question:last").offset().top:t("dt:last").offset().top;t("body,html").animate({scrollTop:n},800)},formatReply:function(i){var n=i.parents(".pinput-answer").find("ul"),a=n.find(".answer-li"),s=0,e=[],p=[],d=[];t.each(a,function(){var i=t(this);if(i.hasClass("li-del"))return!0;var n=Number(i.find(".score input").val());s+=n,p.push(parseInt(i.attr("type"))),d.push(n)}),e.push(p),e.push(d);var l=i.parents("dt"),r=l.attr("data-type");switch(parseInt(r)){case 2:var c=l.attr("qid");break;case 3:var u=l.attr("qsid"),c=i.parents(".pinput-question").attr("qid")}var v={pid:o.pid,qid:parseInt(c),qsid:"undefined"==typeof u?"":parseInt(u),choices:e,score:s};return v},formatChoice:function(i){var n=i.parents("dt"),a=n.attr("data-type"),s=[],e=[];switch(parseInt(a)){case 1:var p=n.attr("qid"),d=n.find(".answer-li");break;case 3:var l=n.attr("qsid"),p=i.parents(".pinput-question").attr("qid"),d=i.parents(".pinput-answer").find(".answer-li")}t.each(d,function(){var i=t(this);return i.hasClass("li-del")?!0:(s.push(i.find(".answer").html()),void(i.find(".choice").hasClass("correct")&&e.push(s.length-1)))});var r={pid:o.pid,qid:parseInt(p),qsid:"undefined"==typeof l?"":parseInt(l),choices:s,answer:e};return r},formatAnalysis:function(i){var n=i.parents("dt"),a=n.attr("data-type"),s={};switch(parseInt(a)){case 1:case 2:var e=n.find(".analysis-li"),p=n.attr("qid");break;case 3:var d=parseInt(n.attr("qsid")),p=i.parents(".pinput-question").attr("qid"),e=i.parents(".analysis-li")}t.each(e,function(){var i=t(this);return i.hasClass("li-del")?!0:void(i.find(".analysis-li1 input").val()?s[i.find(".analysis-li1 input").val()]=i.find(".analysis-li3").html():s["本题解析"]=i.find(".analysis-li3").html())});var l={pid:o.pid,qid:parseInt(p),qsid:"undefined"==typeof d?"":parseInt(d),resolve:s};return l},getLocalTime:function(t){var i=new Date(t),n=i.getFullYear(),a=i.getMonth()+1,s=i.getDate(),e=i.getHours(),p=i.getMinutes();return n+"年"+a+"月"+s+"日 "+e+":"+p},in_array:function(t){for(n=0;n<t.length&&t[n]!=e;n++);return!(n==t.length)},extendScore:function(t,i){switch(i){case 1:var n=t.find("dt[data-type=1]");break;case 3:var n=t.find("div[data-type=1]")}var a=n.size()?n.find(".score input").val():0;return Number(a)}}});